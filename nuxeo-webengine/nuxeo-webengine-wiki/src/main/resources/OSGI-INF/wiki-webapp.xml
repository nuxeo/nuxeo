<?xml version="1.0"?>
<component name="org.nuxeo.ecm.wiki.config">
  <documentation>
    @author Bogdan Stefanescu (bs@nuxeo.com)
    @author Eric Barroca (eb@nuxeo.com)
    Default Wiki Objects
  </documentation>

  <extension target="org.nuxeo.ecm.webengine.WebEngineComponent"
             point="application-mapping">
    <mapping path="/wikis" webapp="wiki" document="/default-domain/workspaces/wikis" />
  </extension>
  
  <extension target="org.nuxeo.ecm.webengine.WebEngineComponent"
             point="application">
    <webapp id="wiki" extends="default">
      <roots>
        <root priority="1">default</root>
        <root priority="10">wiki</root>
      </roots>
      <mappings>
        <mapping pattern="^(.+)/archives/(?year:[0-9]{4})/?(?month:[0-9]{2})?">
          <script>/Blog/archives.groovy</script>
        </mapping>
        <mapping pattern="/login">
          <script>/common/login.groovy</script>
        </mapping>
        <mapping pattern="/user/(?username:[a-zA-Z0-9]+)$">
          <script>/users/user_detail.groovy</script>
        </mapping>
        <mapping pattern=".*/registration_form">
          <script>/users/registration_form.ftl</script>
          <traversal>${path}</traversal>
        </mapping>
      </mappings>
    </webapp>
  </extension>

  <extension target="org.nuxeo.ecm.webengine.WebEngineComponent" point="binding">
    <binding type="WikiPage" objectId="WikiPage"/>`
    <binding type="Wiki" objectId="WikiSite"/>
    <binding type="Blog" objectId="BlogSite"/>
    <binding type="BlogPost" objectId="BlogPost"/>
  </extension>

  <extension target="org.nuxeo.ecm.webengine.WebEngineComponent" point="webObject">
    <object id="WikiObject" extends="WebObject">
      <actions>
        <action id="view" enabled="true">
          <permission expression="Read"/>
        </action>
        <action id="delete" enabled="true" handler="org.nuxeo.ecm.webengine.actions.DeleteActionHandler">
          <permission expression="Write"/>
        </action>
        <action id="update" enabled="true" script="common/update.groovy" handler="org.nuxeo.ecm.webengine.actions.UpateActionHandler">
          <permission expression="Write"/>
        </action>
        <action id="create" enabled="true" script="common/create.groovy" handler="org.nuxeo.ecm.webengine.actions.CreateActionHandler">
          <permission expression="Write"/>
        </action>
        <action id="addfile" enabled="true" script="common/addfile.groovy" handler="org.nuxeo.ecm.webengine.actions.AddFileActionHandler">
          <permission expression="Write"/>
        </action>
        <action id="deletefile" enabled="true" script="common/addfile.groovy" handler="org.nuxeo.ecm.webengine.actions.DeleteFileActionHandler">
          <permission expression="Write"/>
          <action id="edit" enabled="true">
            <permission expression="Write"/>
          </action>
        </action>
      </actions>
    </object>
    <object id="WikiPage" extends="WikiObject">
      <actions>
        <action id="content_page" enabled="true">
          <permission expression="Read"/>
          <category>TABVIEW</category>
        </action>
        <action id="edit_page" enabled="true">
          <permission expression="Write"/>
          <category>TABVIEW</category>
        </action>
        <action id="versions_page" enabled="true">
          <permission expression="Read"/>
          <category>TABVIEW</category>
        </action>
        <action id="show_comments_py" enabled="true" script="comments/getComments.py">
          <permission expression="Read"/>
        </action>
        <action id="comments" enabled="true" script="comments/show_comments.ftl">
          <permission expression="Read"/>
        </action>
        <action id="add_comment" enabled="true" script="comments/addComment.groovy">
          <permission expression="Write"/>
        </action>
        <action id="delete_comment" enabled="true" script="comments/deleteComment.groovy">
          <permission expression="Write"/>
        </action>
        <action id="publish_comment" enabled="true" script="comments/publishComment.groovy">
          <permission expression="Write"/>
        </action>
        <action id="create_form" enabled="true" script="Wiki/create_entry.ftl">
          <permission expression="Write"/>
        </action>
        <action id="preview" enabled="true" script="markitup/preview.ftl">
          <permission expression="Read"/>
        </action>
      </actions>
    </object>
    
    <object id="WikiSite" extends="WikiObject">
      <actions>
        <action id="view" enabled="true" script="Wiki/redirectToFrontpage.groovy">
          <permission expression="Read"/>
        </action>
        <action id="listPages" enabled="true" script="Wiki/listpages.groovy">
          <permission expression="Read"/>
          <category>admin</category>
        </action>
        <action id="deletePage" enabled="true" script="Wiki/deletepage.groovy">
          <permission expression="Write"/>
        </action>
      </actions>
    </object>
    
    <object id="BlogPost" extends="WikiObject">
      <actions>
        <action id="content_page" enabled="true">
          <permission expression="Read"/>
          <category>TABVIEW</category>
        </action>
        <action id="edit" enabled="true">
          <permission expression="Write"/>
          <category>TABVIEW</category>
        </action>
      </actions>
    </object>
    
    <object id="Blog" extends="WikiObjet">
    </object>
    
  </extension>
</component>

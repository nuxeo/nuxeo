<div xmlns:h="http://java.sun.com/jsf/html"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:a4j="http://richfaces.org/a4j">

  <script type="text/javascript">
  function confirmDeleteFolder() {
    return confirm("#{messages['label.folderManager.confirmDeleteFolder']}");
  }
  </script>

  <rich:modalPanel id="createFolderFormPanel" autosized="true"
    styleClass="CreateFolderFormPanel">
    <f:facet name="header">
      <h:panelGroup>
        <h:outputText value="#{messages['title.createFolder']}"/>
      </h:panelGroup>
    </f:facet>
    <f:facet name="controls">
      <h:panelGroup>
        <a4j:form id="createFolderHideForm">
          <a4j:commandLink
            actionListener="#{editableListBean.resetAllListsCachedModels}"
            id="createFolderHideLink"
            onclick="Richfaces.hideModalPanel('createFolderFormPanel')"
            immediate="true" reRender="createFolderPanel">
            <h:graphicImage value="/img/close.png" styleClass="hidelink" />
          </a4j:commandLink>
        </a4j:form>
      </h:panelGroup>
    </f:facet>
    <ui:include src="/incl/create_folder_panel.xhtml" />
  </rich:modalPanel>

  <rich:modalPanel id="viewFolderFormPanel" autosized="true"
    styleClass="ViewFolderFormPanel">
    <f:facet name="header">
      <h:panelGroup>
        <h:outputText value="#{messages['title.editFolder']}" />
      </h:panelGroup>
    </f:facet>
    <f:facet name="controls">
      <h:panelGroup>
        <a4j:form id="viewFolderHideForm">
          <a4j:commandLink
            actionListener="#{editableListBean.resetAllListsCachedModels}"
            id="viewFolderHideLink"
            onclick="Richfaces.hideModalPanel('viewFolderFormPanel')"
            immediate="true" reRender="viewFolderPanel">
            <h:graphicImage value="/img/close.png" styleClass="hidelink" />
          </a4j:commandLink>
        </a4j:form>
      </h:panelGroup>
    </f:facet>
    <ui:include src="/incl/view_folder_panel.xhtml" />
  </rich:modalPanel>

  <table cellspacing="0" cellpadding="0" border="0" style="height: 100%; width: 100%;">
    <tbody>
      <tr>
        <td valign="top" style="width: 210px;">
          <a4j:form id="folderForm">
            <a4j:commandLink
              action="#{folderAdminActions.resetNewFolder()}"
              immediate="true"
              reRender="createFolderPanel"
              oncomplete="Richfaces.showModalPanel('createFolderFormPanel')"
              id="folder_creation_button"
              rendered="#{notReadOnly}">
              <h:outputText value="#{messages['command.createFolder']}" />
            </a4j:commandLink>
            <br /><br />
          </a4j:form>
        </td>
          <td valign="top">
          <a4j:outputPanel id="folderSearchResult">

            <c:set var="userSchema" value="#{userManager.userSchemaName}" />

            <a4j:form id="folderSearchFormTab" rendered="#{folderList.rowCount > 0}">
              <h:dataTable id="FolderSearchTab" var="folder" value="#{folderList}"
                rowClasses="dataRowEven,dataRowOdd" styleClass="dataOutput">
                <h:column>
                  <a4j:commandLink id="delete-folder"
                    action="#{folderAdminActions.deleteFolderNoRedirect(folder.id)}"
                    onclick="if (!confirmDeleteFolder()) { return false; }"
                    reRender="folderSearchResult"
                    rendered="#{notReadOnly}">
                   <h:graphicImage value="/icons/action_delete.gif" />
                 </a4j:commandLink>
                </h:column>
                <h:column>
                  <f:facet name="header">
                      <h:outputText
                        value="#{messages['label.folderName']}" />
                  </f:facet>
                  <a4j:commandLink
                    action="#{folderAdminActions.setSelectedFolder(folder.id)}"
                    oncomplete="Richfaces.showModalPanel('viewFolderFormPanel')"
                    reRender="viewFolderPanel">
                    <h:outputText value="#{documentActions.getTitleCropped(folder,50)}" />
                  </a4j:commandLink>
                </h:column>
                <h:column>
                  <f:facet name="header">
                    <h:outputText
                      value="#{messages['label.dublincore.description']}" />
                  </f:facet>
                  <h:outputText value="#{folder['dublincore'].description}" />
                </h:column>
                <h:column>
                  <f:facet name="header">
                    <h:outputText
                      value="#{messages['label.dublincore.creator']}" />
                  </f:facet>
                  <h:outputText value="#{folder['dublincore'].creator}" />
                </h:column>
                <h:column>
                  <f:facet name="header">
                    <h:outputText
                      value="#{messages['label.dublincore.created']}" />
                  </f:facet>
                  <h:outputText value="#{folder['dublincore'].created}" />
                </h:column>

              </h:dataTable>
            </a4j:form>
          </a4j:outputPanel>
        </td>
      </tr>
    </tbody>
  </table>

</div>


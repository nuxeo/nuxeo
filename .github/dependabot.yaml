version: 2
updates:
  # Default branch: 2021
  - package-ecosystem: "maven"
    directory: "/"
    schedule:
      interval: "daily"
    # Disable version updates on 2021, for now we only want security updates
    open-pull-requests-limit: 0
    ignore:
      # Major security updates
      - dependency-name: "org.jboss.remoting:jboss-remoting"
        versions: ["[3.0,)"]
      - dependency-name: "org.hibernate*:*"
        versions: ["[4.0,)"]
      - dependency-name: "com.h2database:h2"
        versions: ["[2.0,)"]
      - dependency-name: "org.apache.poi:*"
        versions: ["[5.0,)"]

      # Minor security update for Elasticsearch
      - dependency-name: "org.elasticsearch*:*"
        versions: [">7.9.2"]
      # Minor security update for Jackson (needs JAX-RS 2.x)
      - dependency-name: "com.fasterxml.jackson*:*"
        versions: ["[2.13.0,)"]

      # Security update for Chronicle Queue
      - dependency-name: "net.openhft:chronicle-bom"
        versions: [">2.20.40"]
      - dependency-name: "net.openhft:chronicle-threads"
        versions: [">2.17.25"]

  # Ignore pip dependencies
  - package-ecosystem: "pip"
    directory: "/"
    schedule:
      interval: "daily"
    ignore:
      - dependency-name: "*"

  # Branch 2023
  - package-ecosystem: "maven"
    target-branch: "2023"
    directory: "/"
    schedule:
      interval: "daily"
      time: "20:00"
      timezone: "Europe/Paris"
    # Enable version updates along with security updates on 2023, limit to 10 to prevent CI overload
    open-pull-requests-limit: 10
    ignore:
      # Major version updates (doesn't work for security updates, need to list them explicitly, see below)
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]

      # Major security updates
      - dependency-name: "org.jboss.remoting:jboss-remoting"
        versions: ["[3.0,)"]
      - dependency-name: "com.h2database:h2"
        versions: ["[2.0,)"]

      # Minor security update for Elasticsearch
      - dependency-name: "org.elasticsearch*:*"
        versions: [">7.9.2"]
      # Minor security update for Jackson (needs JAX-RS 2.x)
      - dependency-name: "com.fasterxml.jackson*:*"
        versions: ["[2.13.0,)"]

      # Upgraded too often to be useful to track with Dependabot
      - dependency-name: "com.amazonaws:aws-java-sdk-*"

      # Spurious major version update
      - dependency-name: "org.jboss.el:jboss-el"
        versions: [">1.0_02.CR6"]
      - dependency-name: "com.google.apis:google-api-services-drive"
        versions: [">v2-rev20201130-1.31.0"]

      # Minor version update breaking compilation
      - dependency-name: "io.gatling*:*"
        versions: ["[3.4,)"]
      - dependency-name: "org.bouncycastle:*"
        versions: ["[1.70,)"]
      - dependency-name: "org.hibernate:hibernate-core"
        versions: [">3.3.2.GA"]
      - dependency-name: "org.hibernate:hibernate-commons-annotations"
        versions: [">3.1.0.GA"]
      - dependency-name: "org.hibernate:hibernate-validator"
        versions: [">3.1.0.GA"]
      - dependency-name: "org.hibernate:hibernate-annotations"
        versions: [">3.4.0.GA"]
      - dependency-name: "org.hibernate:hibernate-entitymanager"
        versions: [">3.4.0.GA"]
      - dependency-name: "org.scala-lang:scala-library"
        versions: ["[2.13,)"]
      - dependency-name: "com.unboundid.product.scim:scim-sdk"
        versions: ["[1.8,)"]
      - dependency-name: "org.osgi:org.osgi.core"
        versions: ["[4.3,)"]
      - dependency-name: "org.jgrapht:jgrapht-core"
        versions: ["[1.1,)"]

      # Patch version update breaking compilation
      - dependency-name: "org.apache.directory.server:*"
        versions: [">1.5.1"]
      - dependency-name: "org.apache.directory.shared:*"
        versions: [">0.9.7"]
      - dependency-name: "io.dropwizard.metrics5:metrics-bom"
        versions: [">5.0.0-rc3"]

      # Nuxeo patch needed
      - dependency-name: "com.googlecode.owasp-java-html-sanitizer:owasp-java-html-sanitizer"
        versions: [">20211018.2.NX1"]

      # Not in our artifact repository
      - dependency-name: "org.apache.maven.plugins:maven-enforcer-plugin"
        versions: ["1.4.2.jenkins-1"]
      - dependency-name: "javax.inject:javax.inject"
        versions: ["1.0-PFD-1"]

  # Ignore pip dependencies
  - package-ecosystem: "pip"
    target-branch: "2023"
    directory: "/"
    schedule:
      interval: "daily"
    ignore:
      - dependency-name: "*"

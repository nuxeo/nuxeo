<f:subview id="#{widget.id}"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:c="http://java.sun.com/jstl/core">
<c:if test="false">
  @deprecated since 5.9.2 - Use only routes of type 'graph'
</c:if>
  <nxu:set var="isEditableRouteElement" value="#{routingActions.isEditableRouteElement(field_0)}">
  <nxu:set var="isEmptyFork" value="#{routingActions.isEmptyFork(field_0)}">
  <nxu:set var="isEditableStep" value="#{routingActions.isEditableStep(field_0)}">

  <c:if test="#{currentRouteLockedByCurrentUser and (isEditableRouteElement || isEmptyFork || isEditableStep)}">
    <img id="#{field_1}_imgref" class="#{field_1}_popupTarget cellActionIcon"
      src="icons/action_plus.png"
      alt="#{messages['label.widget.document_routing_route_content.dr_listing_step_actions']}"
      title="#{messages['label.widget.document_routing_route_content.dr_listing_step_actions']}" />

    <div>
      <c:set value="#{nxu:concat(field_1, '_menuPopup')}" var="popupId" />
        <script type="text/javascript">
            setupContextMenu("span.popupTarget");
            var options = {
                bind: 'click',
                useFilter: false,
                anchor: '#popupReceiver'
            };
            setupContextMenu('img.#{field_1}_popupTarget','#{popupId}', options);
        </script>

      <div style="display: none;" class="contextMenu" id="#{popupId}">
        <ul>
          <ui:include src="/widgets/listing/add_step_widget_template.xhtml" />
          <ui:include src="/widgets/listing/remove_step_widget_template.xhtml" />
          <ui:include src="/widgets/listing/listing_edit_document_route_element_widget_template.xhtml" />
        </ul>
      </div>
    </div>
  </c:if>
  </nxu:set>
  </nxu:set>
  </nxu:set>
</f:subview>
<?xml version="1.0"?>
<fragment>

  <extension target="web#STD-AUTH-FILTER">
    <filter-mapping>
      <filter-name>NuxeoAuthenticationFilter</filter-name>
      <url-pattern>/nxpicsfile/*</url-pattern>
      <dispatcher>REQUEST</dispatcher>
      <dispatcher>FORWARD</dispatcher>
    </filter-mapping>

    <filter-mapping>
      <filter-name>NuxeoAuthenticationFilter
      </filter-name>
      <url-pattern>/watermark/*</url-pattern>
      <dispatcher>REQUEST</dispatcher>
      <dispatcher>FORWARD</dispatcher>
    </filter-mapping>
  </extension>

  <extension target="application#MODULE">
    <module>
      <ejb>${bundle.fileName}</ejb>
    </module>

    <module>
      <web>
        <web-uri>nuxeo.war</web-uri>
        <context-root>/nuxeo</context-root>
      </web>
    </module>
  </extension>

  <extension target="web#SERVLET">
    <servlet>
      <servlet-name>Image Watermarker</servlet-name>
      <servlet-class>
        org.nuxeo.dam.webapp.watermark.WaterMarkServlet
      </servlet-class>
    </servlet>
    <servlet-mapping>
      <servlet-name>Image Watermarker</servlet-name>
      <url-pattern>/watermark/*</url-pattern>
    </servlet-mapping>
  </extension>

  <extension target="web#FILTER-MAPPING">
    <filter>
      <display-name>Ajax4jsf Filter</display-name>
      <filter-name>ajax4jsf</filter-name>
      <filter-class>org.ajax4jsf.Filter</filter-class>
    </filter>
  </extension>


  <extension target="web#FILTER-MAPPING">
    <!--
      Seam Context Filter is declared in org.nuxeo.ecm.platform.ui.web
      deployment fragment
    -->
    <filter-mapping>
      <filter-name>Seam Context Filter</filter-name>
      <url-pattern>/DocumentManagerWS</url-pattern>
    </filter-mapping>

    <filter-mapping>
      <filter-name>ajax4jsf</filter-name>
      <servlet-name>Faces Servlet</servlet-name>
      <dispatcher>REQUEST</dispatcher>
      <dispatcher>FORWARD</dispatcher>
      <dispatcher>INCLUDE</dispatcher>
      <init-param>
        <param-name>maxRequestSize</param-name>
        <param-value>1000000</param-value>
      </init-param>
    </filter-mapping>
  </extension>

  <extension target="faces-config#APPLICATION">
    <locale-config>
      <default-locale>en</default-locale>
      <supported-locale>en_GB</supported-locale>
      <supported-locale>en_US</supported-locale>
      <supported-locale>fr</supported-locale>
      <supported-locale>de</supported-locale>
      <supported-locale>es</supported-locale>
      <supported-locale>it</supported-locale>
      <supported-locale>ar</supported-locale>
      <supported-locale>ru</supported-locale>
      <supported-locale>ja</supported-locale>
      <supported-locale>vn</supported-locale>
    </locale-config>

    <message-bundle>messages</message-bundle>
  </extension>

  <extension target="faces-config#NAVIGATION">

    <navigation-case>
      <from-outcome>view_documents</from-outcome>
      <to-view-id>/view_documents.xhtml</to-view-id>
      <redirect />
    </navigation-case>

    <navigation-case>
      <from-outcome>home</from-outcome>
      <to-view-id>/nxstartup.xhtml</to-view-id>
      <redirect />
    </navigation-case>

    <navigation-case>
      <from-outcome>annotations_popup</from-outcome>
      <to-view-id>/annotations_popup.xhtml</to-view-id>
    </navigation-case>

    <navigation-case>
      <from-outcome>administration</from-outcome>
      <to-view-id>/administration.xhtml</to-view-id>
      <redirect />
    </navigation-case>

    <navigation-case>
      <from-outcome>view_user</from-outcome>
      <to-view-id>/administration.xhtml</to-view-id>
      <redirect />
    </navigation-case>

    <navigation-case>
      <from-outcome>view_many_users</from-outcome>
      <to-view-id>/administration.xhtml</to-view-id>
      <redirect />
    </navigation-case>

    <navigation-case>
      <from-outcome>view_users</from-outcome>
      <to-view-id>/administration.xhtml</to-view-id>
      <redirect />
    </navigation-case>

  </extension>

  <extension target="pages#PAGES">

    <!-- Post login and 'home' view handler -->
    <page view-id="/nxstartup.xhtml" action="#{startupHelper.initDomainAndFindStartupPage()}" />

  </extension>

</fragment>


<?xml version="1.0"?>
<component name="org.nuxeo.drive.listeners">

  <extension target="org.nuxeo.ecm.core.event.EventServiceComponent" point="listener">
    <documentation>
      Notify the NuxeoDriveManager service to invalidate
      it's cache when a document is deleted (physically or just the
      trash).

      @author Olivier Grisel
    </documentation>

    <listener name="nuxeoDriveCacheInvalidationListener" async="false" postCommit="false"
      class="org.nuxeo.drive.listener.NuxeoDriveCacheInvalidationListener" priority="300">
      <event>lifecycle_transition_event</event>
      <event>documentTrashed</event>
      <event>documentUntrashed</event>
      <event>documentRemoved</event>
      <event>documentSecurityUpdated</event>
      <event>addedToCollection</event>
      <event>removedFromCollection</event>
    </listener>

    <documentation>
      Handle document removal or root unregistration in
      order to be able to
      populate the audit log and hence compute
      consistent change
      summaries for each user.

      @author Olivier Grisel
    </documentation>
    <listener name="nuxeoDriveFileSystemDeletionListener" async="false" postCommit="false"
      class="org.nuxeo.drive.listener.NuxeoDriveFileSystemDeletionListener" priority="200">
      <event>beforeDocumentModification</event>
      <event>aboutToMove</event>
      <event>lifecycle_transition_event</event>
      <event>documentTrashed</event>
      <event>aboutToRemove</event>
      <event>beforeDocumentSecurityModification</event>
      <event>aboutToUnregisterRoot</event>
      <event>beforeRemovedFromCollection</event>
      <event>groupUpdated</event>
    </listener>

    <documentation>
      Populate the audit log with virtual events generated by the nuxeoDriveFileSystemDeletionListener.

      @author Antoine Taillefer
    </documentation>
    <listener name="nuxeoDriveVirtualEventLoggerListener" async="true" postCommit="true"
      class="org.nuxeo.drive.listener.NuxeoDriveVirtualEventLogger" />

    <documentation>
      Handle group change events fired by the UserManager.

      @author Antoine Taillefer
    </documentation>
    <listener name="nuxeoDriveGroupUpdateListener" async="true" postCommit="true"
      class="org.nuxeo.drive.listener.NuxeoDriveGroupUpdateListener">
      <event>group_created</event>
      <event>group_deleted</event>
      <event>group_modified</event>
    </listener>

    <documentation>
      Reset synchronization root registrations on a copied document and its children.
    </documentation>
    <listener name="nuxeoDriveSyncRootCopyListener" async="false" postCommit="false"
      class="org.nuxeo.drive.listener.NuxeoDriveSyncRootCopyListener">
      <event>documentCreatedByCopy</event>
    </listener>

    <documentation>
      Reset synchronization root registrations on a versioned document.
    </documentation>
    <listener name="nuxeoDriveSyncRootVersioningListener" async="false" postCommit="false"
      class="org.nuxeo.drive.listener.NuxeoDriveSyncRootVersioningListener">
      <event>documentCheckedIn</event>
    </listener>

  </extension>

  <extension target="org.nuxeo.ecm.platform.audit.service.NXAuditEventsService" point="event">
    <event name="rootRegistered" />
    <event name="rootUnregistered" />
  </extension>

</component>

<?xml version="1.0"?>
<component name="org.nuxeo.drive.listeners" version="1.0.0">

  <extension target="org.nuxeo.ecm.core.event.EventServiceComponent"
    point="listener">
    <documentation>
      Notify the NuxeoDriveManager service to invalidate
      it's cache when a document is deleted (physically or just the
      trash).

      @author Olivier Grisel
    </documentation>

    <listener name="nuxeoDriveCacheInvalidationListener" async="false"
      postCommit="false"
      class="org.nuxeo.drive.listener.NuxeoDriveCacheInvalidationListener"
      priority="300">
      <event>lifecycle_transition_event</event>
      <event>documentRemoved</event>
      <event>documentSecurityUpdated</event>
      <event>addedToCollection</event>
      <event>removedFromCollection</event>
    </listener>

    <documentation>
      Handle document removal or root unregistration in order to be able to
      populate the audit log and hence compute consistent change
      summaries for each user.

      @author Olivier Grisel
    </documentation>
    <listener name="nuxeoDriveFileSystemDeletionListener" async="false"
      postCommit="false"
      class="org.nuxeo.drive.listener.NuxeoDriveFileSystemDeletionListener"
      priority="200">
      <event>beforeDocumentModification</event>
      <event>aboutToMove</event>
      <event>lifecycle_transition_event</event>
      <event>aboutToRemove</event>
      <event>beforeDocumentSecurityModification</event>
      <event>aboutToUnRegisterRoot</event>
      <event>beforeRemovedFromCollection</event>
    </listener>

    <documentation>
      Handle document removal from the "Locally Edited"
      collection in order to unlock it.

      @author Antoine Taillefer
    </documentation>
    <listener name="nuxeoDriveUnlockListener"
      async="false" postCommit="false"
      class="org.nuxeo.drive.listener.NuxeoDriveUnlockListener"
      priority="400">
      <event>removedFromCollection</event>
    </listener>

  </extension>

  <extension target="org.nuxeo.ecm.platform.audit.service.NXAuditEventsService"
    point="event">
    <event name="rootRegistered" />
    <event name="rootUnregistered" />
  </extension>

</component>

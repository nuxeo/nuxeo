<?xml version="1.0" encoding="UTF-8"?>

<div xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html" xmlns:a4j="http://richfaces.org/a4j" xmlns:nxu="http://nuxeo.org/nxweb/util" xmlns:c="http://java.sun.com/jstl/core" xmlns:rich="http://richfaces.org/rich">  
  <script type="text/javascript">var elementDefined = false; var element; function openSuggestionBox() { if (!elementDefined) { window.element = document.getElementById("suggestionBoxContainer").firstChild; window.elementDefined = true; } document.getElementById(window.element.id).component.callSuggestion(true); }</script>  
  <h:outputText value="#{messages['label.start.workflow']}"/>  
  <c:set var="minChars" value="#{nxu:test(!empty widget.properties.minChars, widget.properties.minChars, '1')}"/>  
  <c:set var="frequency" value="#{nxu:test(!empty widget.properties.frequency, widget.properties.frequency, '0')}"/>  
  <c:set var="requestDelay" value="#{nxu:test(!empty widget.properties.requestDelay, widget.properties.requestDelay, '100')}"/>  
  <a4j:region renderRegionOnly="true" id="a4j_route_region"> 
    <h:panelGrid id="#{widget.id}_route_panel" columns="1"> 
      <h:panelGroup> 
        <span id="#{widget.id}_route_suggestDiv"> 
          <h:panelGrid columns="3"> 
            <h:inputText id="#{widget.id}_route_suggest" onkeydown="if (event.keyCode == 13) {return false;}"/>  
            <h:graphicImage value="/icons/arrow.png" onclick="openSuggestionBox();" alt=""/>  
            <a4j:status> 
              <f:facet name="start"> 
                <h:graphicImage value="/img/standart_waiter.gif"/> 
              </f:facet> 
            </a4j:status> 
          </h:panelGrid> 
        </span>  
        <span id="suggestionBoxContainer"> 
          <rich:suggestionbox id="#{widget.id}_route_suggestionBox" for="#{widget.id}_route_suggest" tokens="" suggestionAction="#{docRoutingSuggestionActions.getRouteModelSuggestions}" var="result" fetchValue="" nothingLabel="#{messages['label.content.empty.search']}" minChars="#{minChars}" frequency="#{frequency}" requestDelay="#{requestDelay}"> 
            <f:param name="mailboxSuggestionSearchType" value="#{widget.properties['mailboxSuggestionSearchType']}"/>  
            <!-- TODO Migrate properly this according to JSF2 -->  
            <a4j:ajax event="select" oncomplete="document.getElementById('#{widget.id}_route_suggest').focus();" bypassUpdates="true" render="#{widget.id}_route_region" id="#{widget.id}_a4jSupport"> 
              <f:param name="mailboxSuggestionSearchType" value="#{widget.properties['mailboxSuggestionSearchType']}"/>  
              <f:setPropertyActionListener value="#{result.id}" target="#{suggestionActions.selectedValue}"/>  
              <nxu:actionListenerMethod value="#{suggestionActions.addSingleBoundSelection}"/>  
              <f:param name="suggestionSelectionHiddenId" value="#{widget.id}_routeId"/>  
              <f:param name="suggestionSelectionOutputId" value="#{widget.id}_route"/>  
              <f:param name="suggestionSelectionDeleteId" value="#{widget.id}_selection_reset"/> 
            </a4j:ajax>  
            <h:column> 
              <h:outputText value="#{result.title}"/> 
            </h:column> 
          </rich:suggestionbox> 
        </span>  
        <h:outputText value="#{messages['label.suggestion.help.combo']} "/> 
      </h:panelGroup>  
      <h:panelGroup> 
        <a4j:outputPanel ajaxRendered="false" layout="block" id="#{widget.id}_route_region"> 
          <a4j:commandLink id="#{widget.id}_selection_reset" immediate="true" actionListener="#{suggestionActions.clearSingleSelection}" ignoreDupResponses="true" execute="@this" bypassUpdates="true" render="#{widget.id}_route_region" rendered="#{!empty field_0}"> 
            <h:graphicImage id="#{widget.id}_delete" value="/icons/delete.png" rendered="false"/>  
            <f:param name="suggestionSelectionOutputId" value="#{widget.id}_route"/>  
            <f:param name="suggestionSelectionHiddenId" value="#{widget.id}_routeId"/>  
            <f:param name="suggestionSelectionDeleteId" value="#{widget.id}_selection_reset"/> 
          </a4j:commandLink>  
          <h:inputHidden id="#{widget.id}_routeId" value="#{field_0}"/>  
          <h:message for="#{widget.id}_routeId" styleClass="errorMessage"/>  
          <h:outputText id="#{widget.id}_route" value="#{field_0}" converter="#{routingActions.documentModelConverter}"/> 
        </a4j:outputPanel> 
      </h:panelGroup> 
    </h:panelGrid> 
  </a4j:region> 
</div>

<div xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  id="#{widget.id}">

  <c:if test="#{not empty field and not empty field.mimeType and field.mimeType.startsWith('audio/')}">
    <c:set var="width"
        value="#{nxu:test(!empty widget.properties.width, widget.properties.width, '100%')}" />

    <nxu:set var="sound_url"
      value="#{nxd:bigFileUrl(value, widget.fieldDefinitions[0].propertyName, field.filename)}">

      <audio id="audioplayer_#{widget.id}" preload="auto" controls="controls" style="width:#{width};">
        <source src="#{sound_url}" />
      </audio>
      <c:if test="#{field.mimeType == 'audio/mpeg'}">
        <script type="text/javascript">
          var audioTag = document.createElement('audio');
          if (!(!!(audioTag.canPlayType) &amp;&amp; ("no" != audioTag.canPlayType("audio/mpeg")) &amp;&amp; ("" != audioTag.canPlayType("audio/mpeg")))) {
              AudioPlayer.setup("#{baseURL}scripts/wpaudioplayer/player.swf", {width: "#{width}", initialvolume: 100});
              AudioPlayer.embed("audioplayer_#{widget.id}", {soundFile: "#{sound_url}"});
          }
        </script>
      </c:if>

    </nxu:set>
  </c:if>

</div>

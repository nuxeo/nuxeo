<div xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:c="http://java.sun.com/jstl/core"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document"
  xmlns:nxl="http://nuxeo.org/nxforms/layout" class="docDiffResult">
  
  <style type="text/css">
    
    #diffHeader {margin-bottom: 0.5em; padding: 0 0.5em 0.5em 0.5em;}
    #diffHeader .dataInput {margin-top: 0;}
    #diffHeader h2 {padding: 0;}
    #diffHeader a.docLink, #diffHeader a.docLink:link, #diffHeader a.docLink:hover {color: #000000;}
    #diffHeader .diffSubTitle {padding-left: 5px; font-style: italic;}
    
    .docDiffResult .foldableBox .boxBody {padding: 0.5em;}
    .docDiffResult .dataInput {width: 100%;}
    
    .docDiffResult .dataInput td {padding: 0.4em 0.3em;}
    .docDiffResult .dataInput td.labelColumn {width: 16%; padding-right: 20px; text-align: left;}
    .docDiffResult .dataInput td.fieldColumn {width: 34%;}
    .docDiffResult .dataInput td.contentDiffColumn {width: 16%; vertical-align: top;}
        
    /*.docDiffResult .dataInput .diffDisplayTable {width: 100%;}*/
    .docDiffResult .dataInput .diffDisplayTable th, .docDiffResult .dataInput .diffDisplayTable td {border: 1px solid #E7E7E7; padding: 0.4em 0.5em;}
    .docDiffResult .dataInput .diffDisplayTable th {background-color:  #EEEFF0; padding: 0.1em 0.5em; text-align: center; font-weight: bold;}
    .docDiffResult .note_content_block {border:none; margin: 0; padding: 0;}
    
    /*.docDiffResult .noBackgroundColor {}*/
    .docDiffResult .redBackgroundColor {display: block; min-height: 18px; min-width: 40px; padding: 0px 4px; background-color: #FDC6C6;}
    .docDiffResult .greenBackgroundColor {display: block; min-height: 18px; min-width: 40px; padding: 0px 4px; background-color: #CCFFCC;}
    
    .docDiffResult .contentDiffLink {margin-right: 10px;}
    
  </style>
  
  <c:if test="#{!diffActions.documentDiffAvailable}">
    <h2>
      <h:outputText value="#{messages['document.diff.noDiffAvailable']}"/>
    </h2>
  </c:if>
  <c:if test="#{diffActions.documentDiffAvailable}">
    
    <nxu:set var="leftDoc" value="#{diffActions.leftDoc}" cache="true">
    <nxu:set var="rightDoc" value="#{diffActions.rightDoc}" cache="true">

    <h:form id="document_diff">
  
      <div id="diffHeader">
        <table class="dataInput">
          <tr>
            <td class="labelColumn">
              <h2>
                <h:outputText value="#{messages['document.diff.title']}" />
              </h2>
            </td>
            <td class="fieldColumn">
              <ui:include src="/incl/diff/doc_title_link.xhtml">
                <ui:param name="doc" value="#{leftDoc}" />
              </ui:include>
            </td>
            <td class="fieldColumn">
              <ui:include src="/incl/diff/doc_title_link.xhtml">
                <ui:param name="doc" value="#{rightDoc}" />
              </ui:include>
            </td>
            <td class="contentDiffColumn">
              <c:if test="#{diffActions.versionDiff}">
                <nxd:restDocumentLink document="#{currentDocument}" tab="TAB_CONTENT_HISTORY"
                  subTab="TAB_VERSIONS" styleClass="docLink">
                  <h:outputText value="#{messages['document.diff.backToVersions']}" />
                </nxd:restDocumentLink>
              </c:if>
            </td>
          </tr>
        </table>
        <h:outputText value="#{messages['document.diff.subTitle']}" styleClass="diffSubTitle" />
      </div>
    
      <c:if test="#{empty defaultDiffDisplayBlocks}">
        <h3>
          <h:outputText value="#{messages['document.diff.emptyDiff']}"/>
        </h3>
      </c:if>
    
      <c:if test="#{!empty defaultDiffDisplayBlocks}">        
        <c:forEach items="#{defaultDiffDisplayBlocks}" var="diffDisplayBlock">
          <div class="foldableBox">
            <h3 class="unfolded">
              <a href="#nologo" onclick="return toggleBox(this)">
                <h:outputText value="#{messages[diffDisplayBlock.label]}" />
              </a>
              <span class="breaker"></span>
            </h3>
            <div class="boxBody">
              <nxl:layout mode="view" definition="#{diffDisplayBlock.layoutDefinition}"
                value="#{diffDisplayBlock}" template="/layouts/layout_diff_template.xhtml"/>
            </div>
          </div>
        </c:forEach>
        <div>
          <h:commandButton value="#{messages['document.diff.refresh']}"
            action="#{diffActions.refresh()}"
            styleClass="button" />
        </div>
        <script>
          jQuery(document).ready(function() {
            jQuery(".widgetHelpLabel").tooltip({relative: true, position: 'bottom center'});
          });
        </script>
      </c:if>
      
    </h:form>
    
    </nxu:set>
    </nxu:set>
    
  </c:if>
  
</div>


!function(){function escapeHTML(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function warnMessage(entry){var markup="";return entry.warn_message&&(markup+="<img src='"+window.nxContextPath+"/icons/warning.gif' title='"+entry.warn_message+"'/>"),markup}function userEntryDefaultFormatter(entry){var markup="";return entry.displayIcon&&entry.type&&("USER_TYPE"==entry.type?markup+="<img src='"+window.nxContextPath+"/icons/user.png' class='smallIcon' />":"GROUP_TYPE"==entry.type&&(markup+="<img src='"+window.nxContextPath+"/icons/group.png' class='smallIcon' />")),markup+=escapeHTML(entry.displayLabel),markup+="&nbsp;<span class='detail'>"+escapeHTML(entry.id)+"</span>",markup+=warnMessage(entry)}function docEntryDefaultFormatter(doc){var markup="<table><tbody>";return markup+="<tr><td>",doc.properties&&doc.properties["common:icon"]&&(markup+="<img src='"+window.nxContextPath+doc.properties["common:icon"]+"' class='smallIcon' />"),markup+="</td><td>",markup+=escapeHTML(doc.title),markup+=warnMessage(doc),doc.path&&(markup+="<span class='displayB detail' style='word-break:break-all;'>"+escapeHTML(doc.path)+"</span>"),markup+="</td></tr></tbody></table>"}function dirEntryDefaultFormatter(entry){var markup=escapeHTML(entry.displayLabel);return markup+=warnMessage(entry)}function docSelectionDefaultFormatter(doc){var markup="<div title='"+escapeHTML(doc.path)+"'>";return doc.properties&&doc.properties["common:icon"]&&(markup+="<img src='"+window.nxContextPath+doc.properties["common:icon"]+"' class='smallIcon' />"),markup+=getDocLinkElt(doc),markup+="</div>",markup+=warnMessage(doc)}function dirSelectionDefaultFormatter(entry){var markup=escapeHTML(entry.absoluteLabel);return markup+=warnMessage(entry)}function getOperationName(params){var opName=params.operationId;return("undefined"==typeof opName||""==opName)&&(opName=params.directoryName&&params.directoryName.length>0?"Directory.SuggestEntries":params.query?"Repository.Query":"Repository.PageProvider"),opName}function getDocLinkElt(doc){if(doc.contextParameters){var url=doc.contextParameters.documentURL,markup="<a href="+url+" onclick='if(!(event.ctrlKey||event.metaKey||event.button==1)){this.href='"+getUrlWithConversationId(url)+"'}'>"+escapeHTML(doc.title)+"</a>";return markup}return escapeHTML(doc.title)}function getUrlWithConversationId(url){return url+"?conversationId="+currentConversationId}function configureOperationParameters(op,params,query){var restoreSeamCtx="true"==params.restoreSeamCtx,temp={};jQuery.extend(temp,params),temp.lang=currentUserLang,"Directory.SuggestEntries"==params.operationId?temp.searchTerm=query.term:"UserGroup.Suggestion"==params.operationId?(temp.searchTerm=query.term,temp.searchType=params.userSuggestionSearchType):"Repository.PageProvider"==params.operationId||"Repository.Query"==params.operationId?(temp.searchTerm=query.term,temp.page="0",temp.pageSize=params.pageSize||"20","Repository.PageProvider"==params.operationId?temp.providerName=params.pageProviderName:temp.query=params.query,"undefined"==typeof temp.quotePatternParameters&&(temp.quotePatternParameters=!1)):temp.searchTerm=query.term,temp.searchTerm=temp.searchTerm.split(",").join("\\,"),params.additionalOperationParameters&&params.additionalOperationParameters.length>0&&(additionalParamsFunction=eval(params.additionalOperationParameters),temp=additionalParamsFunction(temp,params,query)),restoreSeamCtx&&"undefined"!=typeof currentConversationId?(op.addParameter("id",getOperationName(params)),op.addParameter("conversationId",currentConversationId),op.opts.automationParams.context=temp):op.addParameters(temp)}function fillResult(results,data){if("undefined"!=typeof data.length)for(i=0;i<data.length;i++){var entry=data[i];results.push(entry)}else if("undefined"!=typeof data.entries)for(i=0;i<data.entries.length;i++){var doc=data.entries[i];results.push(doc)}else alert("Error with suggestion widget")}function getDefaultLabel(item){return escapeHTML(item.displayLabel?item.displayLabel:item.title)}function getDefaultId(item){return item.computedId?item.computedId:item.uid?item.uid:item.id}function initSelect2Widget(el){if(!el.data("s2Done")){el.data("s2Done",!0);var elid=el.attr("id"),params={},paramId=(elid+"_params").split(":").join("\\:"),paramsHolder=jQuery("#"+paramId),val=paramsHolder.val();if(val){params=JSON.parse(paramsHolder.val());var readonly="true"==params.readonly,required="true"==params.required,restoreSeamCtx="true"==params.restoreSeamCtx,initId=(elid+"_init").split(":").join("\\:"),initHolder=jQuery("#"+initId),initDoc=null;try{initDoc=JSON.parse(initHolder.val())}catch(err){}el.css("width",params.width);var opName=getOperationName(params),automationParams={documentSchemas:params.documentSchemas};params.repository&&(automationParams.repository=params.repository);var op=null;op=restoreSeamCtx&&"undefined"!=typeof currentConversationId?jQuery().automation("Seam.RunOperation",automationParams):jQuery().automation(opName,automationParams);var selectionFormatterFunction=null;params.selectionFormatter&&params.selectionFormatter.length>0&&(selectionFormatterFunction=eval(params.selectionFormatter));var suggestionFormatterFunction=null;params.suggestionFormatter&&params.suggestionFormatter.length>0&&(suggestionFormatterFunction=eval(params.suggestionFormatter));var enterKeyHandlerFunction=null;params.onEnterKeyHandler&&params.onEnterKeyHandler.length>0&&(enterKeyHandlerFunction=eval(params.onEnterKeyHandler));var frequency=300;params.frequency&&params.frequency.length>0&&(frequency=params.frequency);var requestInProgress=!1,nextQueryId,select2_params={containerCssClass:params.containerCssClass,dropdownCssClass:params.dropdownCssClass,minimumInputLength:params.minChars,autocomplete:params.autocomplete,query:function(query){var serverCall=function(){requestInProgress?(window.clearTimeout(nextQueryId),nextQueryId=window.setTimeout(function(){serverCall()},100)):(requestInProgress=!0,configureOperationParameters(op,params,query),op.execute(function(data){var results=[];fillResult(results,data,params),query.callback({results:results}),requestInProgress=!1},function(xhr,status){500==xhr.status&&alert("Error while querying data from server: "+status),requestInProgress=!1}))};window.clearTimeout(nextQueryId),nextQueryId=window.setTimeout(function(){serverCall()},frequency)}};select2_params.formatSelection=null!=selectionFormatterFunction?selectionFormatterFunction:function(doc){return null!=select2_params.labelFieldName?escapeHTML(doc.properties[select2_params.labelFieldName]):getDefaultLabel(doc)},select2_params.formatResult=null!=suggestionFormatterFunction?suggestionFormatterFunction:getDefaultLabel,null!=enterKeyHandlerFunction&&(select2_params.enterKeyHandler=enterKeyHandlerFunction),select2_params.id=params.idProperty&&params.idProperty.length>0?function(doc){return doc.properties[params.idProperty]}:params.idFunction?eval(params.idFunction):"true"==params.prefixed?function(item){return item.prefixed_id}:getDefaultId,null!=initDoc&&(select2_params.initSelection=function(element,callback){callback(initDoc)}),"true"==params.multiple&&(select2_params.maximumSelectionSize=params.maximumSelectionSize,select2_params.multiple=!0),params.placeholder&&!readonly&&(select2_params.placeholder=params.placeholder,select2_params.allowClear=!required);var createSearchChoice=null;params.createSearchChoice&&params.createSearchChoice.length>0&&(createSearchChoice=eval(params.createSearchChoice)),null!=createSearchChoice&&(select2_params.createSearchChoice=createSearchChoice),"true"==params.dropdownOnArrow&&"false"==params.multiple&&(select2_params.dropdownOnArrow=!0),params.separator&&(select2_params.separator=params.separator),params.closeOnSelect&&(select2_params.closeOnSelect="true"===params.closeOnSelect),el.select2(select2_params),readonly&&el.select2("readonly",!0),readonly||("true"==params.multiple&&"true"==params.orderable&&el.select2("container").find("ul.select2-choices").sortable({containment:"parent",start:function(){el.select2("onSortStart")},update:function(){el.select2("onSortEnd")}}),el.on("select2-opening",function(e){params.onclick&&eval(params.onclick)}),el.on("change",function(e){if(e){if(e.added){var newValue;if(select2_params.multiple){var newObj=JSON.parse(initHolder.val());newObj.push(e.added),newValue=JSON.stringify(newObj)}else newValue=JSON.stringify(e.added);initHolder.val(newValue),params.onAddEntryHandler&&eval(params.onAddEntryHandler)(e.added)}if(e.removed){var removedId=select2_params.id(e.removed);if(select2_params.multiple){var newValue="",tempObj=JSON.parse(initHolder.val());jQuery.each(tempObj,function(index,result){result&&select2_params.id(result)==removedId&&tempObj.splice(index,1)}),newValue=JSON.stringify(tempObj),initHolder.val(newValue)}else initHolder.val()==removedId&&initHolder.val("");params.onRemoveEntryHandler&&window[params.onRemoveEntryHandler](e.removed)}}if(params.reRenderFunctionName&&window[params.reRenderFunctionName](),params.onchange){var onchange=eval(params.onchange);"function"==typeof onchange&&onchange(e)}}));var $parentForm=jQuery(el).closest("form");$parentForm.hasClass("safeEditEnabled")&&jQuery(el).closest("form").registerPostRestoreCallBacks(function(){el.data("s2Done",!1),initSelect2Widget(jQuery(el))})}}}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},userSelectionDefaultFormatter=userEntryDefaultFormatter;window.initSelect2AjaxWidget=function(widgetId,index){var selector="input[type='hidden'][id$=";null!=index&&index.length>0&&(selector=selector+index+"\\:"),selector=selector+widgetId+"_select2]",jQuery(selector).each(function(idx,el){initSelect2Widget(jQuery(el))})},window.initSelect2Widgets=function(){jQuery("input[type='hidden'][id$=select2]").each(function(idx,el){initSelect2Widget(jQuery(el))})}}();
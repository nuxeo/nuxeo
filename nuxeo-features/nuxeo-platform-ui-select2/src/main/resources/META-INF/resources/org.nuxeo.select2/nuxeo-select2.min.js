!function(){function escapeHTML(a){return String(a).replace(/[&<>"'\/]/g,function(b){return entityMap[b]})}function warnMessage(a){var b="";return a.warn_message&&(b+="<img src='"+window.nxContextPath+"/icons/warning.gif' title='"+a.warn_message+"'/>"),b}function userEntryDefaultFormatter(a){var b="";return a.displayIcon&&a.type&&("USER_TYPE"==a.type?b+="<img src='"+window.nxContextPath+"/icons/user.png' class='smallIcon' />":"GROUP_TYPE"==a.type&&(b+="<img src='"+window.nxContextPath+"/icons/group.png' class='smallIcon' />")),b+=escapeHTML(a.displayLabel),b+="&nbsp;<span class='detail'>"+escapeHTML(a.id)+"</span>",b+=warnMessage(a)}function docEntryDefaultFormatter(a){var b="<table><tbody>";return b+="<tr><td>",a.properties&&a.properties["common:icon"]&&(b+="<img src='"+window.nxContextPath+a.properties["common:icon"]+"' class='smallIcon' />"),b+="</td><td>",b+=escapeHTML(a.title),b+=warnMessage(a),a.path&&(b+="<span class='displayB detail' style='word-break:break-all;'>"+escapeHTML(a.path)+"</span>"),b+="</td></tr></tbody></table>"}function dirEntryDefaultFormatter(a){var b=escapeHTML(a.displayLabel);return b+=warnMessage(a)}function docSelectionDefaultFormatter(a){var b="<div title='"+escapeHTML(a.path)+"'>";return a.properties&&a.properties["common:icon"]&&(b+="<img src='"+window.nxContextPath+a.properties["common:icon"]+"' class='smallIcon' />"),b+=getDocLinkElt(a),b+="</div>",b+=warnMessage(a)}function dirSelectionDefaultFormatter(a){var b=escapeHTML(a.absoluteLabel);return b+=warnMessage(a)}function getOperationName(a){var b=a.operationId;return"undefined"!=typeof b&&""!=b||(b=a.directoryName&&a.directoryName.length>0?"Directory.SuggestEntries":"Repository.PageProvider"),b}function getDocLinkElt(a){if(a.contextParameters){var b=a.contextParameters.documentURL,c="<a href="+b+" onclick='if(!(event.ctrlKey||event.metaKey||event.button==1)){this.href='"+getUrlWithConversationId(b)+"'}'>"+escapeHTML(a.title)+"</a>";return c}return escapeHTML(a.title)}function getUrlWithConversationId(a){return a+"?conversationId="+currentConversationId}function configureOperationParameters(op,params,query){var restoreSeamCtx="true"==params.restoreSeamCtx,temp={};jQuery.extend(temp,params),temp.lang=currentUserLang,"Directory.SuggestEntries"==params.operationId?temp.searchTerm=query.term:"UserGroup.Suggestion"==params.operationId?(temp.searchTerm=query.term,temp.searchType=params.userSuggestionSearchType):"Repository.PageProvider"==params.operationId?(temp.searchTerm=query.term,temp.query=params.query,temp.providerName=params.pageProviderName,temp.page="0",temp.pageSize="20","undefined"==typeof temp.quotePatternParameters&&(temp.quotePatternParameters=!1)):temp.searchTerm=query.term,temp.searchTerm=temp.searchTerm.replace(",","\\,"),params.additionalOperationParameters&&params.additionalOperationParameters.length>0&&(additionalParamsFunction=eval(params.additionalOperationParameters),temp=additionalParamsFunction(temp,params,query)),restoreSeamCtx&&"undefined"!=typeof currentConversationId?(op.addParameter("id",getOperationName(params)),op.addParameter("conversationId",currentConversationId),op.opts.automationParams.context=temp):op.addParameters(temp)}function fillResult(a,b,c){if("undefined"!=typeof b.length)for(i=0;i<b.length;i++){var d=b[i];a.push(d)}else if("undefined"!=typeof b.entries)for(i=0;i<b.entries.length;i++){var e=b.entries[i];a.push(e)}else alert("Error with suggestion widget")}function getDefaultLabel(a){return escapeHTML(a.displayLabel?a.displayLabel:a.title)}function getDefaultId(a){return a.computedId?a.computedId:a.uid?a.uid:a.id}function initSelect2Widget(el){if(!el.data("s2Done")){el.data("s2Done",!0);var elid=el.attr("id"),params={},paramId=(elid+"_params").split(":").join("\\:"),paramsHolder=jQuery("#"+paramId),val=paramsHolder.val();if(val){params=JSON.parse(paramsHolder.val());var readonly="true"==params.readonly,required="true"==params.required,restoreSeamCtx="true"==params.restoreSeamCtx,initId=(elid+"_init").split(":").join("\\:"),initHolder=jQuery("#"+initId),initDoc=null;try{initDoc=JSON.parse(initHolder.val())}catch(a){}el.css("width",params.width);var opName=getOperationName(params),automationParams={documentSchemas:params.documentSchemas};params.repository&&(automationParams.repository=params.repository);var op=null;op=restoreSeamCtx&&"undefined"!=typeof currentConversationId?jQuery().automation("WebUI.RunOperationInSeam",automationParams):jQuery().automation(opName,automationParams);var selectionFormatterFunction=null;params.selectionFormatter&&params.selectionFormatter.length>0&&(selectionFormatterFunction=eval(params.selectionFormatter));var suggestionFormatterFunction=null;params.suggestionFormatter&&params.suggestionFormatter.length>0&&(suggestionFormatterFunction=eval(params.suggestionFormatter));var enterKeyHandlerFunction=null;params.onEnterKeyHandler&&params.onEnterKeyHandler.length>0&&(enterKeyHandlerFunction=eval(params.onEnterKeyHandler));var requestInProgress=!1,nextQueryId,select2_params={containerCssClass:params.containerCssClass,dropdownCssClass:params.dropdownCssClass,minimumInputLength:params.minChars,autocomplete:params.autocomplete,query:function(a){var b=function(){requestInProgress?(window.clearTimeout(nextQueryId),nextQueryId=window.setTimeout(function(){b()},100)):(requestInProgress=!0,configureOperationParameters(op,params,a),op.execute(function(b,c,d){var e=[];fillResult(e,b,params),a.callback({results:e}),requestInProgress=!1},function(a,b,c){500==a.status&&alert("Error while querying data from server: "+b),requestInProgress=!1}))};window.clearTimeout(nextQueryId),nextQueryId=window.setTimeout(function(){b()},300)}};null!=selectionFormatterFunction?select2_params.formatSelection=selectionFormatterFunction:select2_params.formatSelection=function(a){return null!=select2_params.labelFieldName?escapeHTML(a.properties[select2_params.labelFieldName]):getDefaultLabel(a)},null!=suggestionFormatterFunction?select2_params.formatResult=suggestionFormatterFunction:select2_params.formatResult=getDefaultLabel,null!=enterKeyHandlerFunction&&(select2_params.enterKeyHandler=enterKeyHandlerFunction),params.idProperty&&params.idProperty.length>0?select2_params.id=function(a){return a.properties[params.idProperty]}:params.idFunction?select2_params.id=eval(params.idFunction):"true"==params.prefixed?select2_params.id=function(a){return a.prefixed_id}:select2_params.id=getDefaultId,null!=initDoc&&(select2_params.initSelection=function(a,b){b(initDoc)}),"true"==params.multiple&&(select2_params.maximumSelectionSize=params.maximumSelectionSize,select2_params.multiple=!0),params.placeholder&&!readonly&&(select2_params.placeholder=params.placeholder,select2_params.allowClear=!required);var createSearchChoice=null;params.createSearchChoice&&params.createSearchChoice.length>0&&(createSearchChoice=eval(params.createSearchChoice)),null!=createSearchChoice&&(select2_params.createSearchChoice=createSearchChoice),"true"==params.dropdownOnArrow&&"false"==params.multiple&&(select2_params.dropdownOnArrow=!0),params.separator&&(select2_params.separator=params.separator),el.select2(select2_params),readonly&&el.select2("readonly",!0),readonly||("true"==params.multiple&&"true"==params.orderable&&el.select2("container").find("ul.select2-choices").sortable({containment:"parent",start:function(){el.select2("onSortStart")},update:function(){el.select2("onSortEnd")}}),el.on("select2-opening",function(e){params.onclick&&eval(params.onclick)}),el.on("change",function(e){if(e){if(e.added){var newValue;if(select2_params.multiple){var newObj=JSON.parse(initHolder.val());newObj.push(e.added),newValue=JSON.stringify(newObj)}else newValue=JSON.stringify(e.added);initHolder.val(newValue),params.onAddEntryHandler&&eval(params.onAddEntryHandler)(e.added)}if(e.removed){var removedId=select2_params.id(e.removed);if(select2_params.multiple){var newValue="",tempObj=JSON.parse(initHolder.val());jQuery.each(tempObj,function(a,b){b&&select2_params.id(b)==removedId&&tempObj.splice(a,1)}),newValue=JSON.stringify(tempObj),initHolder.val(newValue)}else initHolder.val()==removedId&&initHolder.val("");params.onRemoveEntryHandler&&window[params.onRemoveEntryHandler](e.removed)}}if(params.reRenderFunctionName&&window[params.reRenderFunctionName](),params.onchange){var onchange=eval(params.onchange);"function"==typeof onchange&&onchange(e)}}));var $parentForm=jQuery(el).closest("form");$parentForm.hasClass("safeEditEnabled")&&jQuery(el).closest("form").registerPostRestoreCallBacks(function(a){el.data("s2Done",!1),initSelect2Widget(jQuery(el))})}}}var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},userSelectionDefaultFormatter=userEntryDefaultFormatter;window.initSelect2AjaxWidget=function(b,c){var d="input[type='hidden'][id$=";null!=c&&c.length>0&&(d=d+c+"\\:"),d=d+b+"_select2]",jQuery(d).each(function(a,b){initSelect2Widget(jQuery(b))})},window.initSelect2Widgets=function(){jQuery("input[type='hidden'][id$=select2]").each(function(a,b){initSelect2Widget(jQuery(b))})}}();
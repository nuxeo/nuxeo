/*
Copyright 2012 Igor Vaynberg

Version: 3.4.1 Timestamp: Thu Jun 27 18:02:10 PDT 2013

This software is licensed under the Apache License, Version 2.0 (the "Apache License") or the GNU
General Public License version 2 (the "GPL License"). You may choose either license to govern your
use of this software only upon the condition that you accept all of the terms of either the Apache
License or the GPL License.

You may obtain a copy of the Apache License and the GPL License at:

http://www.apache.org/licenses/LICENSE-2.0
http://www.gnu.org/licenses/gpl-2.0.html

Unless required by applicable law or agreed to in writing, software distributed under the Apache License
or the GPL Licesnse is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
either express or implied. See the Apache License and the GPL License for the specific language governing
permissions and limitations under the Apache License and the GPL License.
*/
!function(a){void 0===a.fn.each2&&a.fn.extend({each2:function(b){for(var c=a([0]),d=-1,e=this.length;++d<e&&(c.context=c[0]=this[d])&&!1!==b.call(c[0],d,c););return this}})}(jQuery),function($,undefined){"use strict";function indexOf(a,b){for(var c=0,d=b.length;c<d;c+=1)if(equal(a,b[c]))return c;return-1}function measureScrollbar(){var a=$(MEASURE_SCROLLBAR_TEMPLATE);a.appendTo("body");var b={width:a.width()-a[0].clientWidth,height:a.height()-a[0].clientHeight};return a.remove(),b}function equal(a,b){return a===b||a!==undefined&&b!==undefined&&(null!==a&&null!==b&&(a.constructor===String?a+""==b+"":b.constructor===String&&b+""==a+""))}function splitVal(a,b){return null===a||a.length<1?[]:a.split(b)}function getSideBorderPadding(a){return a.outerWidth(!1)-a.width()}function installKeyUpChangeEvent(a){var b="keyup-change-value";a.on("keydown",function(){$.data(a,b)===undefined&&$.data(a,b,a.val())}),a.on("keyup",function(){var c=$.data(a,b);c!==undefined&&a.val()!==c&&($.removeData(a,b),a.trigger("keyup-change"))})}function installFilteredMouseMove(a){a.on("mousemove",function(a){var b=lastMousePosition;b!==undefined&&b.x===a.pageX&&b.y===a.pageY||$(a.target).trigger("mousemove-filtered",a)})}function debounce(a,b,c){c=c||undefined;var d;return function(){var e=arguments;window.clearTimeout(d),d=window.setTimeout(function(){b.apply(c,e)},a)}}function thunk(a){var c,b=!1;return function(){return!1===b&&(c=a(),b=!0),c}}function installDebouncedScroll(a,b){var c=debounce(a,function(a){b.trigger("scroll-debounced",a)});b.on("scroll",function(a){indexOf(a.target,b.get())>=0&&c(a)})}function focus(a){a[0]!==document.activeElement&&window.setTimeout(function(){var d,b=a[0],c=a.val().length;a.focus(),a.is(":visible")&&b===document.activeElement&&(b.setSelectionRange?b.setSelectionRange(c,c):b.createTextRange&&(d=b.createTextRange(),d.collapse(!1),d.select()))},0)}function getCursorInfo(a){a=$(a)[0];var b=0,c=0;if("selectionStart"in a)b=a.selectionStart,c=a.selectionEnd-b;else if("selection"in document){a.focus();var d=document.selection.createRange();c=document.selection.createRange().text.length,d.moveStart("character",-a.value.length),b=d.text.length-c}return{offset:b,length:c}}function killEvent(a){a.preventDefault(),a.stopPropagation()}function killEventImmediately(a){a.preventDefault(),a.stopImmediatePropagation()}function measureTextWidth(a){if(!sizer){var b=a[0].currentStyle||window.getComputedStyle(a[0],null);sizer=$(document.createElement("div")).css({position:"absolute",left:"-10000px",top:"-10000px",display:"none",fontSize:b.fontSize,fontFamily:b.fontFamily,fontStyle:b.fontStyle,fontWeight:b.fontWeight,letterSpacing:b.letterSpacing,textTransform:b.textTransform,whiteSpace:"nowrap"}),sizer.attr("class","select2-sizer"),$("body").append(sizer)}return sizer.text(a.val()),sizer.width()}function syncCssClasses(a,b,c){var d,f,e=[];d=a.attr("class"),d&&(d=""+d,$(d.split(" ")).each2(function(){0===this.indexOf("select2-")&&e.push(this)})),d=b.attr("class"),d&&(d=""+d,$(d.split(" ")).each2(function(){0!==this.indexOf("select2-")&&(f=c(this))&&e.push(this)})),a.attr("class",e.join(" "))}function markMatch(a,b,c,d){var e=a.toUpperCase().indexOf(b.toUpperCase()),f=b.length;if(e<0)return void c.push(d(a));c.push(d(a.substring(0,e))),c.push("<span class='select2-match'>"),c.push(d(a.substring(e,e+f))),c.push("</span>"),c.push(d(a.substring(e+f,a.length)))}function defaultEscapeMarkup(a){var b={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return String(a).replace(/[&<>"'\/\\]/g,function(a){return b[a]})}function ajax(a){var b,c=0,d=null,e=a.quietMillis||100,f=a.url,g=this;return function(h){window.clearTimeout(b),b=window.setTimeout(function(){c+=1;var b=c,e=a.data,i=f,j=a.transport||$.fn.select2.ajaxDefaults.transport,k={type:a.type||"GET",cache:a.cache||!1,jsonpCallback:a.jsonpCallback||undefined,dataType:a.dataType||"json"},l=$.extend({},$.fn.select2.ajaxDefaults.params,k);e=e?e.call(g,h.term,h.page,h.context):null,i="function"==typeof i?i.call(g,h.term,h.page,h.context):i,d&&d.abort(),a.params&&($.isFunction(a.params)?$.extend(l,a.params.call(g)):$.extend(l,a.params)),$.extend(l,{url:i,dataType:a.dataType,data:e,success:function(d){if(!(b<c)){var e=a.results(d,h.page);h.callback(e)}}}),d=j.call(g,l)},e)}}function local(a){var c,d,b=a,e=function(a){return""+a.text};$.isArray(b)&&(d=b,b={results:d}),!1===$.isFunction(b)&&(d=b,b=function(){return d});var f=b();return f.text&&(e=f.text,$.isFunction(e)||(c=f.text,e=function(a){return a[c]})),function(a){var f,c=a.term,d={results:[]};if(""===c)return void a.callback(b());f=function(b,d){var g,h;if(b=b[0],b.children){g={};for(h in b)b.hasOwnProperty(h)&&(g[h]=b[h]);g.children=[],$(b.children).each2(function(a,b){f(b,g.children)}),(g.children.length||a.matcher(c,e(g),b))&&d.push(g)}else a.matcher(c,e(b),b)&&d.push(b)},$(b().results).each2(function(a,b){f(b,d.results)}),a.callback(d)}}function tags(a){var b=$.isFunction(a);return function(c){var d=c.term,e={results:[]};$(b?a():a).each(function(){var a=this.text!==undefined,b=a?this.text:this;(""===d||c.matcher(d,b))&&e.results.push(a?this:{id:this,text:this})}),c.callback(e)}}function checkFormatter(a,b){if($.isFunction(a))return!0;if(!a)return!1;throw new Error(b+" must be a function or a falsy value")}function evaluate(a){return $.isFunction(a)?a():a}function countResults(a){var b=0;return $.each(a,function(a,c){c.children?b+=countResults(c.children):b++}),b}function defaultTokenizer(a,b,c,d){var g,h,i,j,k,e=a,f=!1;if(!d.createSearchChoice||!d.tokenSeparators||d.tokenSeparators.length<1)return undefined;for(;;){for(h=-1,i=0,j=d.tokenSeparators.length;i<j&&(k=d.tokenSeparators[i],!((h=a.indexOf(k))>=0));i++);if(h<0)break;if(g=a.substring(0,h),a=a.substring(h+k.length),g.length>0&&(g=d.createSearchChoice.call(this,g,b))!==undefined&&null!==g&&d.id(g)!==undefined&&null!==d.id(g)){for(f=!1,i=0,j=b.length;i<j;i++)if(equal(d.id(g),d.id(b[i]))){f=!0;break}f||c(g)}}return e!==a?a:void 0}function clazz(a,b){var c=function(){};return c.prototype=new a,c.prototype.constructor=c,c.prototype.parent=a.prototype,c.prototype=$.extend(c.prototype,b),c}if(window.Select2===undefined){var KEY,AbstractSelect2,SingleSelect2,MultiSelect2,nextUid,sizer,lastMousePosition={x:0,y:0},$document,scrollBarDimensions,KEY={TAB:9,ENTER:13,ESC:27,SPACE:32,LEFT:37,UP:38,RIGHT:39,DOWN:40,SHIFT:16,CTRL:17,ALT:18,PAGE_UP:33,PAGE_DOWN:34,HOME:36,END:35,BACKSPACE:8,DELETE:46,isArrow:function(a){switch(a=a.which?a.which:a){case KEY.LEFT:case KEY.RIGHT:case KEY.UP:case KEY.DOWN:return!0}return!1},isControl:function(a){switch(a.which){case KEY.SHIFT:case KEY.CTRL:case KEY.ALT:return!0}return!!a.metaKey},isFunctionKey:function(a){return(a=a.which?a.which:a)>=112&&a<=123}},MEASURE_SCROLLBAR_TEMPLATE="<div class='select2-measure-scrollbar'></div>";$document=$(document),nextUid=function(){var a=1;return function(){return a++}}(),$document.on("mousemove",function(a){lastMousePosition.x=a.pageX,lastMousePosition.y=a.pageY}),AbstractSelect2=clazz(Object,{bind:function(a){var b=this;return function(){a.apply(b,arguments)}},init:function(a){var b,c,e,f,d=".select2-results";this.opts=a=this.prepareOpts(a),this.id=a.id,a.element.data("select2")!==undefined&&null!==a.element.data("select2")&&a.element.data("select2").destroy(),this.container=this.createContainer(),this.containerId="s2id_"+(a.element.attr("id")||"autogen"+nextUid()),this.containerSelector="#"+this.containerId.replace(/([;&,\.\+\*\~':"\!\^#$%@\[\]\(\)=>\|])/g,"\\$1"),this.container.attr("id",this.containerId),this.body=thunk(function(){return a.element.closest("body")}),syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.css(evaluate(a.containerCss)),this.container.addClass(evaluate(a.containerCssClass)),this.elementTabIndex=this.opts.element.attr("tabindex"),this.opts.element.data("select2",this).attr("tabindex","-1").before(this.container),this.container.data("select2",this),this.dropdown=this.container.find(".select2-drop"),this.dropdown.addClass(evaluate(a.dropdownCssClass)),this.dropdown.data("select2",this),this.results=b=this.container.find(d),this.search=c=this.container.find("input.select2-input"),this.resultsPage=0,this.context=null,this.initContainer(),installFilteredMouseMove(this.results),this.dropdown.on("mousemove-filtered touchstart touchmove touchend",d,this.bind(this.highlightUnderEvent)),installDebouncedScroll(80,this.results),this.dropdown.on("scroll-debounced",d,this.bind(this.loadMoreIfNeeded)),$(this.container).on("change",".select2-input",function(a){a.stopPropagation()}),$(this.dropdown).on("change",".select2-input",function(a){a.stopPropagation()}),$.fn.mousewheel&&b.mousewheel(function(a,c,d,e){var f=b.scrollTop();e>0&&f-e<=0?(b.scrollTop(0),killEvent(a)):e<0&&b.get(0).scrollHeight-b.scrollTop()+e<=b.height()&&(b.scrollTop(b.get(0).scrollHeight-b.height()),killEvent(a))}),installKeyUpChangeEvent(c),c.on("keyup-change input paste",this.bind(this.updateResults)),c.on("focus",function(){c.addClass("select2-focused")}),c.on("blur",function(){c.removeClass("select2-focused")}),this.dropdown.on("mouseup",d,this.bind(function(a){$(a.target).closest(".select2-result-selectable").length>0&&(this.highlightUnderEvent(a),this.selectHighlighted(a))})),this.dropdown.on("click mouseup mousedown",function(a){a.stopPropagation()}),$.isFunction(this.opts.initSelection)&&(this.initSelection(),this.monitorSource()),null!==a.maximumInputLength&&this.search.attr("maxlength",a.maximumInputLength);var e=a.element.prop("disabled");e===undefined&&(e=!1),this.enable(!e);var f=a.element.prop("readonly");f===undefined&&(f=!1),this.readonly(f),scrollBarDimensions=scrollBarDimensions||measureScrollbar(),this.autofocus=a.element.prop("autofocus"),a.element.prop("autofocus",!1),this.autofocus&&this.focus()},destroy:function(){var a=this.opts.element,b=a.data("select2");this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),b!==undefined&&(b.container.remove(),b.dropdown.remove(),a.removeClass("select2-offscreen").removeData("select2").off(".select2").prop("autofocus",this.autofocus||!1),this.elementTabIndex?a.attr({tabindex:this.elementTabIndex}):a.removeAttr("tabindex"),a.show())},optionToData:function(a){return a.is("option")?{id:a.prop("value"),text:a.text(),element:a.get(),css:a.attr("class"),disabled:a.prop("disabled"),locked:equal(a.attr("locked"),"locked")||equal(a.data("locked"),!0)}:a.is("optgroup")?{text:a.attr("label"),children:[],element:a.get(),css:a.attr("class")}:void 0},prepareOpts:function(a){var b,c,d,e,f=this;if(b=a.element,"select"===b.get(0).tagName.toLowerCase()&&(this.select=c=a.element),c&&$.each(["id","multiple","ajax","query","createSearchChoice","initSelection","data","tags"],function(){if(this in a)throw new Error("Option '"+this+"' is not allowed for Select2 when attached to a <select> element.")}),a=$.extend({},{populateResults:function(b,c,d){var e,j=this.opts.id;(e=function(b,c,g){var h,i,k,l,m,n,o,p,q,r;for(b=a.sortResults(b,c,d),h=0,i=b.length;h<i;h+=1)k=b[h],m=!0===k.disabled,l=!m&&j(k)!==undefined,n=k.children&&k.children.length>0,o=$("<li></li>"),o.addClass("select2-results-dept-"+g),o.addClass("select2-result"),o.addClass(l?"select2-result-selectable":"select2-result-unselectable"),m&&o.addClass("select2-disabled"),n&&o.addClass("select2-result-with-children"),o.addClass(f.opts.formatResultCssClass(k)),p=$(document.createElement("div")),p.addClass("select2-result-label"),r=a.formatResult(k,p,d,f.opts.escapeMarkup),r!==undefined&&p.html(r),o.append(p),n&&(q=$("<ul></ul>"),q.addClass("select2-result-sub"),e(k.children,q,g+1),o.append(q)),o.data("select2-data",k),c.append(o)})(c,b,0)}},$.fn.select2.defaults,a),"function"!=typeof a.id&&(d=a.id,a.id=function(a){return a[d]}),$.isArray(a.element.data("select2Tags"))){if("tags"in a)throw"tags specified as both an attribute 'data-select2-tags' and in options of Select2 "+a.element.attr("id");a.tags=a.element.data("select2Tags")}if(c?(a.query=this.bind(function(a){var e,g,h,c={results:[],more:!1},d=a.term;h=function(b,c){var e;b.is("option")?a.matcher(d,b.text(),b)&&c.push(f.optionToData(b)):b.is("optgroup")&&(e=f.optionToData(b),b.children().each2(function(a,b){h(b,e.children)}),e.children.length>0&&c.push(e))},e=b.children(),this.getPlaceholder()!==undefined&&e.length>0&&(g=this.getPlaceholderOption())&&(e=e.not(g)),e.each2(function(a,b){h(b,c.results)}),a.callback(c)}),a.id=function(a){return a.id},a.formatResultCssClass=function(a){return a.css}):"query"in a||("ajax"in a?(e=a.element.data("ajax-url"),e&&e.length>0&&(a.ajax.url=e),a.query=ajax.call(a.element,a.ajax)):"data"in a?a.query=local(a.data):"tags"in a&&(a.query=tags(a.tags),a.createSearchChoice===undefined&&(a.createSearchChoice=function(a){return{id:a,text:a}}),a.initSelection===undefined&&(a.initSelection=function(b,c){var d=[];$(splitVal(b.val(),a.separator)).each(function(){var b=this,c=this,e=a.tags;$.isFunction(e)&&(e=e()),$(e).each(function(){if(equal(this.id,b))return c=this.text,!1}),d.push({id:b,text:c})}),c(d)}))),"function"!=typeof a.query)throw"query function not defined for Select2 "+a.element.attr("id");return a},monitorSource:function(){var b,a=this.opts.element;a.on("change.select2",this.bind(function(a){!0!==this.opts.element.data("select2-change-triggered")&&this.initSelection()})),b=this.bind(function(){var c,e=a.prop("disabled");e===undefined&&(e=!1),this.enable(!e);var c=a.prop("readonly");c===undefined&&(c=!1),this.readonly(c),syncCssClasses(this.container,this.opts.element,this.opts.adaptContainerCssClass),this.container.addClass(evaluate(this.opts.containerCssClass)),syncCssClasses(this.dropdown,this.opts.element,this.opts.adaptDropdownCssClass),this.dropdown.addClass(evaluate(this.opts.dropdownCssClass))}),a.on("propertychange.select2 DOMAttrModified.select2",b),this.mutationCallback===undefined&&(this.mutationCallback=function(a){a.forEach(b)}),"undefined"!=typeof WebKitMutationObserver&&(this.propertyObserver&&(delete this.propertyObserver,this.propertyObserver=null),this.propertyObserver=new WebKitMutationObserver(this.mutationCallback),this.propertyObserver.observe(a.get(0),{attributes:!0,subtree:!1}))},triggerSelect:function(a){var b=$.Event("select2-selecting",{val:this.id(a),object:a});return this.opts.element.trigger(b),!b.isDefaultPrevented()},triggerChange:function(a){a=a||{},a=$.extend({},a,{type:"change",val:this.val()}),this.opts.element.data("select2-change-triggered",!0),this.opts.element.trigger(a),this.opts.element.data("select2-change-triggered",!1),this.opts.element.click(),this.opts.blurOnChange&&this.opts.element.blur()},isInterfaceEnabled:function(){return!0===this.enabledInterface},enableInterface:function(){var a=this._enabled&&!this._readonly,b=!a;return a!==this.enabledInterface&&(this.container.toggleClass("select2-container-disabled",b),this.close(),this.enabledInterface=a,!0)},enable:function(a){return a===undefined&&(a=!0),this._enabled!==a&&(this._enabled=a,this.opts.element.prop("disabled",!a),this.enableInterface(),!0)},readonly:function(a){return a===undefined&&(a=!1),this._readonly!==a&&(this._readonly=a,this.opts.element.prop("readonly",a),this.enableInterface(),!0)},opened:function(){return this.container.hasClass("select2-dropdown-open")},positionDropdown:function(){var o,p,q,r,a=this.dropdown,b=this.container.offset(),c=this.container.outerHeight(!1),d=this.container.outerWidth(!1),e=a.outerHeight(!1),f=$(window).scrollLeft()+$(window).width(),g=$(window).scrollTop()+$(window).height(),h=b.top+c,i=b.left,j=h+e<=g,k=b.top-e>=this.body().scrollTop(),l=a.outerWidth(!1),m=i+l<=f,n=a.hasClass("select2-drop-above");this.opts.dropdownAutoWidth?(r=$(".select2-results",a)[0],a.addClass("select2-drop-auto-width"),a.css("width",""),l=a.outerWidth(!1)+(r.scrollHeight===r.clientHeight?0:scrollBarDimensions.width),l>d?d=l:l=d,m=i+l<=f):this.container.removeClass("select2-drop-auto-width"),"static"!==this.body().css("position")&&(o=this.body().offset(),h-=o.top,i-=o.left),n?(p=!0,!k&&j&&(p=!1)):(p=!1,!j&&k&&(p=!0)),m||(i=b.left+d-l),p?(h=b.top-e,this.container.addClass("select2-drop-above"),a.addClass("select2-drop-above")):(this.container.removeClass("select2-drop-above"),a.removeClass("select2-drop-above")),q=$.extend({top:h,left:i,width:d},evaluate(this.opts.dropdownCss)),a.css(q)},shouldOpen:function(){var a;return!this.opened()&&(!1!==this._enabled&&!0!==this._readonly&&(a=$.Event("select2-opening"),this.opts.element.trigger(a),!a.isDefaultPrevented()))},clearDropdownAlignmentPreference:function(){this.container.removeClass("select2-drop-above"),this.dropdown.removeClass("select2-drop-above")},open:function(){return!!this.shouldOpen()&&(this.opening(),!0)},opening:function(){function i(){return{width:Math.max(document.documentElement.scrollWidth,$(window).width()),height:Math.max(document.documentElement.scrollHeight,$(window).height())}}var e,f,a=this.containerId,b="scroll."+a,c="resize."+a,d="orientationchange."+a;if(this.container.addClass("select2-dropdown-open").addClass("select2-container-active"),this.clearDropdownAlignmentPreference(),this.dropdown[0]!==this.body().children().last()[0]){var g=this.dropdown.width();this.dropdown.detach().appendTo(this.body()),this.dropdown.width(g)}e=$("#select2-drop-mask"),0==e.length&&(e=$(document.createElement("div")),e.attr("id","select2-drop-mask").attr("class","select2-drop-mask"),e.hide(),e.appendTo(this.body()),e.on("mousedown touchstart click",function(a){var c,b=$("#select2-drop");b.length>0&&(c=b.data("select2"),c.opts.selectOnBlur&&c.selectHighlighted({noFocus:!0}),c.close(),a.preventDefault(),a.stopPropagation())})),this.dropdown.prev()[0]!==e[0]&&this.dropdown.before(e),$("#select2-drop").removeAttr("id"),this.dropdown.attr("id","select2-drop"),f=i(),e.css(f).show(),this.dropdown.show(),(!this.opts.autocomplete||this.search.val().length>0)&&this.positionDropdown(),this.dropdown.addClass("select2-drop-active");var h=this;this.container.parents().add(window).each(function(){$(this).on(c+" "+b+" "+d,function(a){var b=i();$("#select2-drop-mask").css(b),h.positionDropdown()})})},close:function(){if(this.opened()){var a=this.containerId,b="scroll."+a,c="resize."+a,d="orientationchange."+a;this.container.parents().add(window).each(function(){$(this).off(b).off(c).off(d)}),this.clearDropdownAlignmentPreference(),$("#select2-drop-mask").hide(),this.dropdown.removeAttr("id"),this.dropdown.hide(),this.container.removeClass("select2-dropdown-open"),this.results.empty(),this.opts.autocomplete||this.clearSearch(),this.search.removeClass("select2-active"),this.opts.element.trigger($.Event("select2-close"))}},externalSearch:function(a){this.open(),this.search.val(a),this.updateResults(!1)},clearSearch:function(){},getMaximumSelectionSize:function(){return evaluate(this.opts.maximumSelectionSize)},ensureHighlightVisible:function(){var b,c,d,e,f,g,h,a=this.results;if(!((c=this.highlight())<0)){if(0==c)return void a.scrollTop(0);b=this.findHighlightableChoices().find(".select2-result-label"),d=$(b[c]),e=d.offset().top+d.outerHeight(!0),c===b.length-1&&(h=a.find("li.select2-more-results"),h.length>0&&(e=h.offset().top+h.outerHeight(!0))),f=a.offset().top+a.outerHeight(!0),e>f&&a.scrollTop(a.scrollTop()+(e-f)),g=d.offset().top-a.offset().top,g<0&&"none"!=d.css("display")&&a.scrollTop(a.scrollTop()+g)}},findHighlightableChoices:function(){return this.results.find(".select2-result-selectable:not(.select2-selected):not(.select2-disabled)")},moveHighlight:function(a){for(var b=this.findHighlightableChoices(),c=this.highlight();c>-1&&c<b.length;){c+=a;var d=$(b[c]);if(d.hasClass("select2-result-selectable")&&!d.hasClass("select2-disabled")&&!d.hasClass("select2-selected")){this.highlight(c);break}}},highlight:function(a){var c,d,b=this.findHighlightableChoices();if(0===arguments.length)return indexOf(b.filter(".select2-highlighted")[0],b.get());a>=b.length&&(a=b.length-1),a<0&&(a=0),this.results.find(".select2-highlighted").removeClass("select2-highlighted"),c=$(b[a]),c.addClass("select2-highlighted"),this.ensureHighlightVisible(),(d=c.data("select2-data"))&&this.opts.element.trigger({type:"select2-highlight",val:this.id(d),choice:d})},countSelectableResults:function(){return this.findHighlightableChoices().length},highlightUnderEvent:function(a){var b=$(a.target).closest(".select2-result-selectable");if(b.length>0&&!b.is(".select2-highlighted")){var c=this.findHighlightableChoices();this.highlight(c.index(b))}else 0==b.length&&this.results.find(".select2-highlighted").removeClass("select2-highlighted")},loadMoreIfNeeded:function(){var a=this.results,b=a.find("li.select2-more-results"),e=this.resultsPage+1,f=this,g=this.search.val(),h=this.context;0!==b.length&&b.offset().top-a.offset().top-a.height()<=this.opts.loadMorePadding&&(b.addClass("select2-active"),this.opts.query({element:this.opts.element,term:g,page:e,context:h,matcher:this.opts.matcher,callback:this.bind(function(c){f.opened()&&(f.opts.populateResults.call(this,a,c.results,{term:g,page:e,context:h}),f.postprocessResults(c,!1,!1),!0===c.more?(b.detach().appendTo(a).text(f.opts.formatLoadMore(e+1)),window.setTimeout(function(){f.loadMoreIfNeeded()},10)):b.remove(),f.positionDropdown(),f.resultsPage=e,f.context=c.context)})}))},tokenize:function(){},updateResults:function(a){function j(){b.removeClass("select2-active"),f.positionDropdown()}function k(a){c.html(a),j()}var e,g,b=this.search,c=this.results,d=this.opts,f=this,h=b.val(),i=$.data(this.container,"select2-last-term");if((!0===a||!i||!equal(h,i))&&($.data(this.container,"select2-last-term",h),!0===a||!1!==this.showSearchInput&&this.opened())){var l=this.getMaximumSelectionSize();if(l>=1&&(e=this.data(),$.isArray(e)&&e.length>=l&&checkFormatter(d.formatSelectionTooBig,"formatSelectionTooBig")))return void k("<li class='select2-selection-limit'>"+d.formatSelectionTooBig(l)+"</li>");if(b.val().length<d.minimumInputLength)return this.opts.autocomplete||k(checkFormatter(d.formatInputTooShort,"formatInputTooShort")?"<li class='select2-no-results'>"+d.formatInputTooShort(b.val(),d.minimumInputLength)+"</li>":""),void(a&&this.showSearch&&this.showSearch(!0));if(d.maximumInputLength&&b.val().length>d.maximumInputLength)return void k(checkFormatter(d.formatInputTooLong,"formatInputTooLong")?"<li class='select2-no-results'>"+d.formatInputTooLong(b.val(),d.maximumInputLength)+"</li>":"");d.formatSearching&&0===this.findHighlightableChoices().length&&k("<li class='select2-searching'>"+d.formatSearching()+"</li>"),b.addClass("select2-active"),g=this.tokenize(),g!=undefined&&null!=g&&b.val(g),this.resultsPage=1,d.query({element:d.element,term:b.val(),page:this.resultsPage,context:null,matcher:d.matcher,callback:this.bind(function(e){var g;return this.opened()?(this.context=e.context===undefined?null:e.context,this.opts.createSearchChoice&&""!==b.val()&&(g=this.opts.createSearchChoice.call(f,b.val(),e.results))!==undefined&&null!==g&&f.id(g)!==undefined&&null!==f.id(g)&&0===$(e.results).filter(function(){return equal(f.id(this),f.id(g))}).length&&e.results.unshift(g),0===e.results.length&&checkFormatter(d.formatNoMatches,"formatNoMatches")?void k("<li class='select2-no-results'>"+d.formatNoMatches(b.val())+"</li>"):(c.empty(),f.opts.populateResults.call(this,c,e.results,{term:b.val(),page:this.resultsPage,context:null}),!0===e.more&&checkFormatter(d.formatLoadMore,"formatLoadMore")&&(c.append("<li class='select2-more-results'>"+f.opts.escapeMarkup(d.formatLoadMore(this.resultsPage))+"</li>"),window.setTimeout(function(){f.loadMoreIfNeeded()},10)),this.postprocessResults(e,a),j(),void this.opts.element.trigger({type:"select2-loaded",items:e}))):void this.search.removeClass("select2-active")})})}},cancel:function(){this.close()},blur:function(){this.opts.selectOnBlur&&this.selectHighlighted({noFocus:!0}),this.close(),this.container.removeClass("select2-container-active"),this.search[0]===document.activeElement&&this.search.blur(),this.clearSearch(),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus")},focusSearch:function(){focus(this.search)},selectHighlighted:function(a){var b=this.highlight(),c=this.results.find(".select2-highlighted"),d=c.closest(".select2-result").data("select2-data");d?(this.highlight(b),this.onSelect(d,a)):a&&a.noFocus&&this.close()},getPlaceholder:function(){var a;return this.opts.element.attr("placeholder")||this.opts.element.attr("data-placeholder")||this.opts.element.data("placeholder")||this.opts.placeholder||((a=this.getPlaceholderOption())!==undefined?a.text():undefined)},getPlaceholderOption:function(){if(this.select){var a=this.select.children().first();if(this.opts.placeholderOption!==undefined)return"first"===this.opts.placeholderOption&&a||"function"==typeof this.opts.placeholderOption&&this.opts.placeholderOption(this.select);if(""===a.text()&&""===a.val())return a}},initContainerWidth:function(){function a(){var a,b,c,d,e;if("off"===this.opts.width)return null;if("element"===this.opts.width)return 0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px";if("copy"===this.opts.width||"resolve"===this.opts.width){if((a=this.opts.element.attr("style"))!==undefined)for(b=a.split(";"),d=0,e=b.length;d<e;d+=1)if(null!==(c=b[d].replace(/\s/g,"").match(/width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i))&&c.length>=1)return c[1];return"resolve"===this.opts.width?(a=this.opts.element.css("width"),a.indexOf("%")>0?a:0===this.opts.element.outerWidth(!1)?"auto":this.opts.element.outerWidth(!1)+"px"):null}return $.isFunction(this.opts.width)?this.opts.width():this.opts.width}var b=a.call(this);null!==b&&this.container.css("width",b)}}),SingleSelect2=clazz(AbstractSelect2,{createContainer:function(){return $(document.createElement("div")).attr({class:"select2-container"}).html(["<a href='javascript:void(0)' onclick='return false;' class='select2-choice' tabindex='-1'>","   <span class='select2-chosen'>&nbsp;</span><abbr class='select2-search-choice-close'></abbr>","   <span class='select2-arrow'><b></b></span>","</a>","<input class='select2-focusser select2-offscreen' type='text'/>","<div class='select2-drop select2-display-none'>","   <div class='select2-search'>","       <input type='text' autocomplete='off' autocorrect='off' autocapitalize='off' spellcheck='false' class='select2-input'/>","   </div>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.focusser.prop("disabled",!this.isInterfaceEnabled())},opening:function(){var a,b,c;this.opts.minimumResultsForSearch>=0&&this.showSearch(!0),this.parent.opening.apply(this,arguments),!1!==this.showSearchInput&&this.search.val(this.focusser.val()),this.search.focus(),a=this.search.get(0),a.createTextRange?(b=a.createTextRange(),b.collapse(!1),b.select()):a.setSelectionRange&&(c=this.search.val().length,a.setSelectionRange(c,c)),this.focusser.prop("disabled",!0).val(""),this.updateResults(!0),this.opts.element.trigger($.Event("select2-open"))},close:function(){this.opened()&&(this.parent.close.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus())},focus:function(){this.opened()?this.close():(this.focusser.removeAttr("disabled"),this.focusser.focus())},isFocused:function(){return this.container.hasClass("select2-container-active")},cancel:function(){this.parent.cancel.apply(this,arguments),this.focusser.removeAttr("disabled"),this.focusser.focus()},initContainer:function(){var a,b=this.container,c=this.dropdown;this.opts.minimumResultsForSearch<0?this.showSearch(!1):this.showSearch(!0),this.selection=a=b.find(".select2-choice"),this.focusser=b.find(".select2-focusser"),this.focusser.attr("id","s2id_autogen"+nextUid()),$("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.focusser.attr("id")),this.focusser.attr("tabindex",this.elementTabIndex),this.search.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()){if(a.which===KEY.PAGE_UP||a.which===KEY.PAGE_DOWN)return void killEvent(a);switch(a.which){case KEY.UP:case KEY.DOWN:return this.moveHighlight(a.which===KEY.UP?-1:1),void killEvent(a);case KEY.ENTER:return this.selectHighlighted(),void killEvent(a);case KEY.TAB:return void this.selectHighlighted({noFocus:!0});case KEY.ESC:return this.cancel(a),void killEvent(a)}}})),this.search.on("blur",this.bind(function(a){document.activeElement===this.body().get(0)&&window.setTimeout(this.bind(function(){this.search.focus()}),0)})),this.focusser.on("keydown",this.bind(function(a){if(this.isInterfaceEnabled()&&a.which!==KEY.TAB&&!KEY.isControl(a)&&!KEY.isFunctionKey(a)&&a.which!==KEY.ESC){if(!1===this.opts.openOnEnter&&a.which===KEY.ENTER)return void killEvent(a);if(a.which==KEY.DOWN||a.which==KEY.UP||a.which==KEY.ENTER&&this.opts.openOnEnter){if(a.altKey||a.ctrlKey||a.shiftKey||a.metaKey)return;return this.open(),void killEvent(a)}return a.which==KEY.DELETE||a.which==KEY.BACKSPACE?(this.opts.allowClear&&this.clear(),void killEvent(a)):void 0}})),installKeyUpChangeEvent(this.focusser),this.focusser.on("keyup-change input",this.bind(function(a){if(this.opts.minimumResultsForSearch>=0){if(a.stopPropagation(),this.opened())return;this.open()}})),a.on("mousedown","abbr",this.bind(function(a){this.isInterfaceEnabled()&&(this.clear(),killEventImmediately(a),this.close(),this.selection.focus())}));var d=function(a){this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.opened()?this.close():this.isInterfaceEnabled()&&this.open(),killEvent(a)};!0===this.opts.dropdownOnArrow?a.on("mousedown",".select2-arrow",this.bind(d)):a.on("mousedown",this.bind(d)),c.on("mousedown",this.bind(function(){this.search.focus()})),a.on("focus",this.bind(function(a){killEvent(a)})),this.focusser.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.container.addClass("select2-container-active")})).on("blur",this.bind(function(){this.opened()||(this.container.removeClass("select2-container-active"),this.opts.element.trigger($.Event("select2-blur")))})),this.search.on("focus",this.bind(function(){this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.container.addClass("select2-container-active")})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.setPlaceholder()},clear:function(a){var b=this.selection.data("select2-data");if(b){var c=this.getPlaceholderOption();this.opts.element.val(c?c.val():""),this.selection.find(".select2-chosen").empty(),this.selection.removeData("select2-data"),this.setPlaceholder(),!1!==a&&(this.opts.element.trigger({type:"select2-removed",val:this.id(b),choice:b}),this.triggerChange({removed:b}))}},initSelection:function(){if(this.isPlaceholderOptionSelected())this.updateSelection([]),this.close(),this.setPlaceholder();else{var b=this;this.opts.initSelection.call(null,this.opts.element,function(a){a!==undefined&&null!==a&&(b.updateSelection(a),b.close(),b.setPlaceholder())})}},isPlaceholderOptionSelected:function(){var a;return(a=this.getPlaceholderOption())!==undefined&&a.is(":selected")||""===this.opts.element.val()||this.opts.element.val()===undefined||null===this.opts.element.val()},prepareOpts:function(){var a=this.parent.prepareOpts.apply(this,arguments),b=this;return"select"===a.element.get(0).tagName.toLowerCase()?a.initSelection=function(a,c){var d=a.find(":selected");c(b.optionToData(d))}:"data"in a&&(a.initSelection=a.initSelection||function(b,c){var d=b.val(),e=null;a.query({matcher:function(b,c,f){var g=equal(d,a.id(f));return g&&(e=f),g},callback:$.isFunction(c)?function(){c(e)}:$.noop})}),a},getPlaceholder:function(){return this.select&&this.getPlaceholderOption()===undefined?undefined:this.parent.getPlaceholder.apply(this,arguments)},setPlaceholder:function(){var a=this.getPlaceholder();if(this.isPlaceholderOptionSelected()&&a!==undefined){if(this.select&&this.getPlaceholderOption()===undefined)return;this.selection.find(".select2-chosen").html(this.opts.escapeMarkup(a)),this.selection.addClass("select2-default"),this.container.removeClass("select2-allowclear")}},postprocessResults:function(a,b,c){var d=0,e=this;if(this.findHighlightableChoices().each2(function(a,b){if(equal(e.id(b.data("select2-data")),e.opts.element.val()))return d=a,!1}),!1!==c&&(!0===b&&d>=0?this.highlight(d):this.highlight(0)),!0===b){var g=this.opts.minimumResultsForSearch;g>=0&&this.showSearch(countResults(a.results)>=g)}},showSearch:function(a){this.showSearchInput!==a&&(this.showSearchInput=a,this.dropdown.find(".select2-search").toggleClass("select2-search-hidden",!a),this.dropdown.find(".select2-search").toggleClass("select2-offscreen",!a),$(this.dropdown,this.container).toggleClass("select2-with-searchbox",a))},onSelect:function(a,b){if(this.triggerSelect(a)){var c=this.opts.element.val(),d=this.data();this.opts.element.val(this.id(a)),this.updateSelection(a),this.opts.element.trigger({type:"select2-selected",val:this.id(a),choice:a}),this.close(),b&&b.noFocus||this.selection.focus(),equal(c,this.id(a))||this.triggerChange({added:a,removed:d})}},updateSelection:function(a){var c,d,b=this.selection.find(".select2-chosen");this.selection.data("select2-data",a),b.empty(),c=this.opts.formatSelection(a,b,this.opts.escapeMarkup),c!==undefined&&b.append(c),d=this.opts.formatSelectionCssClass(a,b),d!==undefined&&b.addClass(d),this.selection.removeClass("select2-default"),this.opts.allowClear&&this.getPlaceholder()!==undefined&&this.container.addClass("select2-allowclear")},val:function(){var a,b=!1,c=null,d=this,e=this.data();if(0===arguments.length)return this.opts.element.val();if(a=arguments[0],arguments.length>1&&(b=arguments[1]),this.select)this.select.val(a).find(":selected").each2(function(a,b){return c=d.optionToData(b),!1}),this.updateSelection(c),this.setPlaceholder(),b&&this.triggerChange({added:c,removed:e});else{if(!a&&0!==a)return void this.clear(b);if(this.opts.initSelection===undefined)throw new Error("cannot call val() if initSelection() is not defined");this.opts.element.val(a),this.opts.initSelection(this.opts.element,function(a){d.opts.element.val(a?d.id(a):""),d.updateSelection(a),d.setPlaceholder(),b&&d.triggerChange({added:a,removed:e})})}},clearSearch:function(){this.search.val(""),this.focusser.val("")},data:function(a,b){var c;if(0===arguments.length)return c=this.selection.data("select2-data"),c==undefined&&(c=null),c;a&&""!==a?(c=this.data(),this.opts.element.val(a?this.id(a):""),this.updateSelection(a),b&&this.triggerChange({added:a,removed:c})):this.clear(b)}}),MultiSelect2=clazz(AbstractSelect2,{createContainer:function(){return $(document.createElement("div")).attr({class:"select2-container select2-container-multi"}).html(["<ul class='select2-choices'>","  <li class='select2-search-field'>","    <input type='text' autocomplete='off' autocorrect='off' autocapitilize='off' spellcheck='false' class='select2-input'>","  </li>","</ul>","<div class='select2-drop select2-drop-multi select2-display-none'>","   <ul class='select2-results'>","   </ul>","</div>"].join(""))},prepareOpts:function(){var a=this.parent.prepareOpts.apply(this,arguments),b=this;return"select"===a.element.get(0).tagName.toLowerCase()?a.initSelection=function(a,c){var d=[];a.find(":selected").each2(function(a,c){d.push(b.optionToData(c))}),c(d)}:"data"in a&&(a.initSelection=a.initSelection||function(b,c){var d=splitVal(b.val(),a.separator),e=[];a.query({matcher:function(b,c,f){var g=$.grep(d,function(b){return equal(b,a.id(f))}).length;return g&&e.push(f),g},callback:$.isFunction(c)?function(){for(var b=[],f=0;f<d.length;f++)for(var g=d[f],h=0;h<e.length;h++){var i=e[h];if(equal(g,a.id(i))){b.push(i),e.splice(h,1);break}}c(b)}:$.noop})}),a},selectChoice:function(a){var b=this.container.find(".select2-search-choice-focus");b.length&&a&&a[0]==b[0]||(b.length&&this.opts.element.trigger("choice-deselected",b),b.removeClass("select2-search-choice-focus"),a&&a.length&&(this.close(),a.addClass("select2-search-choice-focus"),this.opts.element.trigger("choice-selected",a)))},initContainer:function(){var selector=".select2-choices",selection;this.searchContainer=this.container.find(".select2-search-field"),this.selection=selection=this.container.find(selector);var _this=this;this.selection.on("mousedown",".select2-search-choice",function(a){_this.search[0].focus(),_this.selectChoice($(this))}),this.search.attr("id","s2id_autogen"+nextUid()),$("label[for='"+this.opts.element.attr("id")+"']").attr("for",this.search.attr("id")),this.search.on("input paste",this.bind(function(){this.isInterfaceEnabled()&&(this.opened()||this.open())})),this.search.attr("tabindex",this.elementTabIndex),this.keydowns=0,this.search.on("keydown",this.bind(function(e){if(this.isInterfaceEnabled()){++this.keydowns;var selected=selection.find(".select2-search-choice-focus"),prev=selected.prev(".select2-search-choice:not(.select2-locked)"),next=selected.next(".select2-search-choice:not(.select2-locked)"),pos=getCursorInfo(this.search);if(selected.length&&(e.which==KEY.LEFT||e.which==KEY.RIGHT||e.which==KEY.BACKSPACE||e.which==KEY.DELETE||e.which==KEY.ENTER)){var selectedChoice=selected;return e.which==KEY.LEFT&&prev.length?selectedChoice=prev:e.which==KEY.RIGHT?selectedChoice=next.length?next:null:e.which===KEY.BACKSPACE?(this.unselect(selected.first()),this.search.width(10),selectedChoice=prev.length?prev:next):e.which==KEY.DELETE?(this.unselect(selected.first()),this.search.width(10),selectedChoice=next.length?next:null):e.which==KEY.ENTER&&(selectedChoice=null),this.selectChoice(selectedChoice),killEvent(e),void(selectedChoice&&selectedChoice.length||this.open())}if((e.which===KEY.BACKSPACE&&1==this.keydowns||e.which==KEY.LEFT)&&0==pos.offset&&!pos.length)return this.selectChoice(selection.find(".select2-search-choice:not(.select2-locked)").last()),void killEvent(e);if(this.selectChoice(null),this.opened())switch(e.which){case KEY.UP:case KEY.DOWN:return this.moveHighlight(e.which===KEY.UP?-1:1),void killEvent(e);case KEY.ENTER:return void(null!=this.opts.enterKeyHandler?(eval(this.opts.enterKeyHandler)(this.search.val()),killEvent(e)):(this.selectHighlighted(),killEvent(e)));case KEY.TAB:return this.selectHighlighted({noFocus:!0}),void this.close();case KEY.ESC:return this.cancel(e),void killEvent(e)}if(e.which!==KEY.TAB&&!KEY.isControl(e)&&!KEY.isFunctionKey(e)&&e.which!==KEY.BACKSPACE&&e.which!==KEY.ESC){if(e.which===KEY.ENTER){if(!1===this.opts.openOnEnter)return;if(e.altKey||e.ctrlKey||e.shiftKey||e.metaKey)return}this.open(),e.which!==KEY.PAGE_UP&&e.which!==KEY.PAGE_DOWN||killEvent(e),e.which===KEY.ENTER&&killEvent(e)}}})),this.search.on("keyup",this.bind(function(a){this.keydowns=0,this.resizeSearch()})),this.search.on("blur",this.bind(function(a){this.container.removeClass("select2-container-active"),this.search.removeClass("select2-focused"),this.selectChoice(null),this.opened()||this.clearSearch(),a.stopImmediatePropagation(),this.opts.element.trigger($.Event("select2-blur"))})),this.container.on("click",selector,this.bind(function(a){this.isInterfaceEnabled()&&($(a.target).closest(".select2-search-choice").length>0||(this.selectChoice(null),this.clearPlaceholder(),this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.open(),this.focusSearch(),a.preventDefault()))})),this.container.on("focus",selector,this.bind(function(){this.isInterfaceEnabled()&&(this.container.hasClass("select2-container-active")||this.opts.element.trigger($.Event("select2-focus")),this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"),this.clearPlaceholder())})),this.initContainerWidth(),this.opts.element.addClass("select2-offscreen"),this.clearSearch()},enableInterface:function(){this.parent.enableInterface.apply(this,arguments)&&this.search.prop("disabled",!this.isInterfaceEnabled())},initSelection:function(){if(""===this.opts.element.val()&&""===this.opts.element.text()&&(this.updateSelection([]),this.close(),this.clearSearch()),this.select||""!==this.opts.element.val()){var b=this;this.opts.initSelection.call(null,this.opts.element,function(a){a!==undefined&&null!==a&&(b.updateSelection(a),b.close(),b.clearSearch())})}},clearSearch:function(){var a=this.getPlaceholder(),b=this.getMaxSearchWidth();a!==undefined&&0===this.getVal().length&&!1===this.search.hasClass("select2-focused")?(this.search.val(a).addClass("select2-default"),this.search.width(b>0?b:this.container.css("width"))):this.search.val("").width(10)},clearPlaceholder:function(){this.search.hasClass("select2-default")&&this.search.val("").removeClass("select2-default")},opening:function(){this.clearPlaceholder(),this.resizeSearch(),this.parent.opening.apply(this,arguments),this.focusSearch(),this.updateResults(!0),this.search.focus(),this.opts.element.trigger($.Event("select2-open"))},close:function(){this.opened()&&this.parent.close.apply(this,arguments)},focus:function(){this.close(),this.search.focus()},isFocused:function(){return this.search.hasClass("select2-focused")},updateSelection:function(a){var b=[],c=[],d=this;$(a).each(function(){indexOf(d.id(this),b)<0&&(b.push(d.id(this)),c.push(this))}),a=c,this.selection.find(".select2-search-choice").remove(),$(a).each(function(){d.addSelectedChoice(this)}),d.postprocessResults()},tokenize:function(){var a=this.search.val();null!=(a=this.opts.tokenizer.call(this,a,this.data(),this.bind(this.onSelect),this.opts))&&a!=undefined&&(this.search.val(a),a.length>0&&this.open())},onSelect:function(a,b){this.triggerSelect(a)&&(this.addSelectedChoice(a),this.opts.element.trigger({type:"selected",val:this.id(a),choice:a}),!this.select&&this.opts.closeOnSelect||this.postprocessResults(),this.opts.closeOnSelect?(this.close(),this.search.width(10),this.resizeSearch()):this.countSelectableResults()>0?(this.search.width(10),this.resizeSearch(),this.getMaximumSelectionSize()>0&&this.val().length>=this.getMaximumSelectionSize()&&this.updateResults(!0),this.positionDropdown()):(this.close(),this.search.width(10)),this.triggerChange({added:a}),b&&b.noFocus||this.focusSearch())},cancel:function(){this.close(),this.focusSearch()},addSelectedChoice:function(a){if(this.opts.autocomplete)return void this.selection.find(".select2-search-field input").val(a.label);var h,i,b=!a.locked,c=$("<li class='select2-search-choice'>    <div></div>    <a href='#' onclick='return false;' class='select2-search-choice-close' tabindex='-1'></a></li>"),d=$("<li class='select2-search-choice select2-locked'><div></div></li>"),e=b?c:d,f=this.id(a),g=this.getVal();h=this.opts.formatSelection(a,e.find("div"),this.opts.escapeMarkup),h!=undefined&&e.find("div").replaceWith("<div>"+h+"</div>"),i=this.opts.formatSelectionCssClass(a,e.find("div")),i!=undefined&&e.addClass(i),b&&e.find(".select2-search-choice-close").on("mousedown",killEvent).on("click dblclick",this.bind(function(a){this.isInterfaceEnabled()&&($(a.target).closest(".select2-search-choice").fadeOut("fast",this.bind(function(){this.unselect($(a.target)),this.selection.find(".select2-search-choice-focus").removeClass("select2-search-choice-focus"),this.close(),this.focusSearch()})).dequeue(),killEvent(a))})).on("focus",this.bind(function(){this.isInterfaceEnabled()&&(this.container.addClass("select2-container-active"),this.dropdown.addClass("select2-drop-active"))})),e.data("select2-data",a),e.insertBefore(this.searchContainer),g.push(f),this.setVal(g)},unselect:function(a){var c,d,b=this.getVal();if(a=a.closest(".select2-search-choice"),0===a.length)throw"Invalid argument: "+a+". Must be .select2-search-choice";(c=a.data("select2-data"))&&(d=indexOf(this.id(c),b),d>=0&&(b.splice(d,1),this.setVal(b),this.select&&this.postprocessResults()),a.remove(),this.opts.element.trigger({type:"removed",val:this.id(c),choice:c}),this.triggerChange({removed:c}))},postprocessResults:function(a,b,c){var d=this.getVal(),e=this.results.find(".select2-result"),f=this.results.find(".select2-result-with-children"),g=this;e.each2(function(a,b){indexOf(g.id(b.data("select2-data")),d)>=0&&(b.addClass("select2-selected"),b.find(".select2-result-selectable").addClass("select2-selected"))}),f.each2(function(a,b){b.is(".select2-result-selectable")||0!==b.find(".select2-result-selectable:not(.select2-selected)").length||b.addClass("select2-selected")}),-1==this.highlight()&&!1!==c&&g.highlight(0),!this.opts.autocomplete&&!this.opts.createSearchChoice&&!e.filter(".select2-result:not(.select2-selected)").length>0&&(!a||a&&!a.more&&0===this.results.find(".select2-no-results").length)&&checkFormatter(g.opts.formatNoMatches,"formatNoMatches")&&this.results.append("<li class='select2-no-results'>"+g.opts.formatNoMatches(g.search.val())+"</li>")},getMaxSearchWidth:function(){return this.selection.width()-getSideBorderPadding(this.search)},resizeSearch:function(){var a,b,c,d,e,f=getSideBorderPadding(this.search);a=measureTextWidth(this.search)+10,b=this.search.offset().left,c=this.selection.width(),d=this.selection.offset().left,e=c-(b-d)-f,e<a&&(e=c-f),e<40&&(e=c-f),e<=0&&(e=a),this.search.width(e)},getVal:function(){var a;return this.select?(a=this.select.val(),null===a?[]:a):(a=this.opts.element.val(),splitVal(a,this.opts.separator))},setVal:function(a){var b;this.select?this.select.val(a):(b=[],$(a).each(function(){indexOf(this,b)<0&&b.push(this)}),this.opts.element.val(0===b.length?"":b.join(this.opts.separator)))},buildChangeDetails:function(a,b){for(var b=b.slice(0),a=a.slice(0),c=0;c<b.length;c++)for(var d=0;d<a.length;d++)equal(this.opts.id(b[c]),this.opts.id(a[d]))&&(b.splice(c,1),c--,a.splice(d,1),d--);return{added:b,removed:a}},val:function(a,b){var c,d=this;if(0===arguments.length)return this.getVal();if(c=this.data(),c.length||(c=[]),!a&&0!==a)return this.opts.element.val(""),this.updateSelection([]),this.clearSearch(),void(b&&this.triggerChange({added:this.data(),removed:c}));if(this.setVal(a),this.select)this.opts.initSelection(this.select,this.bind(this.updateSelection)),b&&this.triggerChange(this.buildChangeDetails(c,this.data()));else{if(this.opts.initSelection===undefined)throw new Error("val() cannot be called if initSelection() is not defined");this.opts.initSelection(this.opts.element,function(a){var e=$.map(a,d.id);d.setVal(e),d.updateSelection(a),d.clearSearch(),b&&d.triggerChange(this.buildChangeDetails(c,this.data()))})}this.clearSearch()},onSortStart:function(){if(this.select)throw new Error("Sorting of elements is not supported when attached to <select>. Attach to <input type='hidden'/> instead.");this.search.width(0),this.searchContainer.hide()},onSortEnd:function(){var a=[],b=this;this.searchContainer.show(),this.searchContainer.appendTo(this.searchContainer.parent()),this.resizeSearch(),this.selection.find(".select2-search-choice").each(function(){a.push(b.opts.id($(this).data("select2-data")))}),this.setVal(a),this.triggerChange()},data:function(a,b){var d,e,c=this;if(0===arguments.length)return this.selection.find(".select2-search-choice").map(function(){return $(this).data("select2-data")}).get();e=this.data(),a||(a=[]),d=$.map(a,function(a){return c.opts.id(a)}),this.setVal(d),this.updateSelection(a),this.clearSearch(),b&&this.triggerChange(this.buildChangeDetails(e,this.data()))}}),$.fn.select2=function(){var b,c,d,e,f,j,a=Array.prototype.slice.call(arguments,0),g=["val","destroy","opened","open","close","focus","isFocused","container","dropdown","onSortStart","onSortEnd","enable","readonly","positionDropdown","data","search"],h=["val","opened","isFocused","container","data"],i={search:"externalSearch"};return this.each(function(){if(0===a.length||"object"==typeof a[0])b=0===a.length?{}:$.extend({},a[0]),b.element=$(this),"select"===b.element.get(0).tagName.toLowerCase()?f=b.element.prop("multiple"):(j=b.autocomplete||!1,f=b.multiple||!1||j,j&&(b.maximumSelectionSize=1),"tags"in b&&(b.multiple=f=!0)),c=f?new MultiSelect2:new SingleSelect2,c.init(b);else{if("string"!=typeof a[0])throw"Invalid arguments to select2 plugin: "+a;if(indexOf(a[0],g)<0)throw"Unknown method: "+a[0];if(e=undefined,(c=$(this).data("select2"))===undefined)return;if(d=a[0],"container"===d?e=c.container:"dropdown"===d?e=c.dropdown:(i[d]&&(d=i[d]),e=c[d].apply(c,a.slice(1))),indexOf(a[0],h)>=0)return!1}}),e===undefined?this:e},$.fn.select2.defaults={width:"copy",loadMorePadding:0,closeOnSelect:!0,openOnEnter:!0,containerCss:{},dropdownCss:{},containerCssClass:"",dropdownCssClass:"",formatResult:function(a,b,c,d){var e=[];return markMatch(a.text,c.term,e,d),e.join("")},formatSelection:function(a,b,c){return a?c(a.text):undefined},sortResults:function(a,b,c){return a},formatResultCssClass:function(a){return undefined},formatSelectionCssClass:function(a,b){return undefined},formatNoMatches:function(){return"No matches found"},formatInputTooShort:function(a,b){var c=b-a.length;return"Please enter "+c+" more character"+(1==c?"":"s")},formatInputTooLong:function(a,b){var c=a.length-b;return"Please delete "+c+" character"+(1==c?"":"s")},formatSelectionTooBig:function(a){return"You can only select "+a+" item"+(1==a?"":"s")},formatLoadMore:function(a){return"Loading more results..."},formatSearching:function(){return"Searching..."},minimumResultsForSearch:0,minimumInputLength:0,maximumInputLength:null,maximumSelectionSize:0,id:function(a){return a.id},matcher:function(a,b){return(""+b).toUpperCase().indexOf((""+a).toUpperCase())>=0},separator:",",tokenSeparators:[],tokenizer:defaultTokenizer,escapeMarkup:defaultEscapeMarkup,blurOnChange:!1,selectOnBlur:!1,adaptContainerCssClass:function(a){return a},adaptDropdownCssClass:function(a){return null}},$.fn.select2.ajaxDefaults={transport:$.ajax,params:{type:"GET",cache:!1,dataType:"json"}},window.Select2={query:{ajax:ajax,local:local,tags:tags},util:{debounce:debounce,markMatch:markMatch,escapeMarkup:defaultEscapeMarkup},class:{abstract:AbstractSelect2,single:SingleSelect2,multi:MultiSelect2}}}}(jQuery);

<div xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:a4j="https://ajax4jsf.dev.java.net/ajax"
  xmlns:nxdir="http://nuxeo.org/nxdirectory"
  xmlns:t="http://myfaces.apache.org/tomahawk"
  xmlns:nxu="http://nuxeo.org/nxweb/util"
  xmlns:nxd="http://nuxeo.org/nxweb/document">

  <!-- XXX: the /nuxeo/ prefix should be dynamically looked up -->
  <script language="javascript">
    function popupSearch(createFormId, url) {
      popup = window.open(url, '_blank', 'toolbar=0, scrollbars=1, location=0, statusbar=0, menubar=0, resizable=1, dependent=1, width=712, height=480');
      if(!popup.opener) {
        popup.opener = window;
      }
      return false;
    }
  </script>

  <h3>
    <h:form>
      <h:commandLink actionListener="#{relationActions.toggleCreateForm}">
        <h:graphicImage url="/img/toggle_plus.png" rendered="#{!relationActions.showCreateForm}" />
        <h:graphicImage url="/img/toggle_minus.png" rendered="#{relationActions.showCreateForm}" />
        <h:outputText value="#{messages['title.create.relation']}" />
      </h:commandLink>
    </h:form>
  </h3>

  <h:form id="createForm" rendered="#{relationActions.showCreateForm}">
    <t:selectOneRadio id="objectType" value="#{relationActions.objectType}"
      binding="#{relationCreationBean.objectTypeInput}" layout="spread">
      <f:selectItem itemLabel="#{messages['label.relation.object.text']}" itemValue="literal"/>
      <f:selectItem itemLabel="#{messages['label.relation.object.uri']}" itemValue="uri"/>
      <f:selectItem itemLabel="#{messages['label.relation.object.documentUid']}" itemValue="document"/>
    </t:selectOneRadio>
    <h:panelGrid columns="2" styleClass="dataInput"
      columnClasses="relationCreateLabelColumn, relationCreateFieldColumn">
      <h:outputLabel for="predicateUri" value="#{messages['label.relation.predicate']}"
        class="required relationPredicateLabel" />
      <h:panelGroup>
        <nxdir:selectOneListbox
          value="#{relationActions.predicateUri}"
          directoryName="predicates"
          id="predicateUri"
          required="true"
          localize="true" />
        <h:message for="predicateUri" class="errorMessage" />
      </h:panelGroup>
      <h:outputLabel for="objectType" value="#{messages['label.relation.object']}"
        class="required relationObjectLabel" />
      <h:panelGroup>
        <h:panelGrid columns="2">

          <t:radio for="objectType" index="0" id="literal" />
          <h:panelGroup>
            <h:inputText id="objectLiteralValue" value="#{relationActions.objectLiteralValue}"
              binding="#{relationCreationBean.objectLiteralValueInput}" size="60"
              styleClass="dataInputTextNoSize" />
          </h:panelGroup>

          <t:radio for="objectType" index="1" id="uri" />
          <h:panelGroup>
            <h:inputText id="objectUri" value="#{relationActions.objectUri}"
              binding="#{relationCreationBean.objectUriInput}" size="60"
              styleClass="dataInputTextNoSize" />
          </h:panelGroup>

          <t:radio for="objectType" index="2" id="document" />
          <h:panelGroup>
            <h:outputText id="objectDocumentTitle"
              value="#{relationCreationBean.objectDocumentTitleInput.localValue}" />
            <h:inputHidden id="objectDocumentTitleSaved"
              value="#{relationActions.objectDocumentTitle}"
              binding="#{relationCreationBean.objectDocumentTitleInput}"/>
            <h:inputHidden id="objectDocumentUid"
              value="#{relationActions.objectDocumentUid}"
              binding="#{relationCreationBean.objectDocumentUidInput}"/>
            <nxu:methodResult name="url"
              value="#{restHelper.addCurrentConversationParameters('/nuxeo/create_relation_search_document_popup.faces')}">
              <input type="button" value="#{messages['command.search']}" class="button"
                onclick="javascript:popupSearch(this.form.id, '#{url}');" />
            </nxu:methodResult>
          </h:panelGroup>

        </h:panelGrid>
        <h:inputHidden id="objectCheck" validator="#{relationCreationBean.validateObject}"
         value="needed"/>
        <h:message for="objectCheck" class="errorMessage" />
        <h:message for="objectType" class="errorMessage" />
      </h:panelGroup>

      <h:outputLabel for="comment" value="#{messages['label.relation.comment']}"
        class="relationCommentLabel" />
      <h:panelGroup>
        <h:inputTextarea class="dataInputText" id="comment" value="#{relationActions.comment}" rows="3" cols="60"/>
        <h:message for="comment" class="errorMessage" />
      </h:panelGroup>

      <h:outputLabel for="objectType" value="" />
      <h:commandButton type="submit" value="#{messages['command.add']}" styleClass="button"
        action="#{relationActions.addStatement}" />
    </h:panelGrid>
  </h:form>

</div>
